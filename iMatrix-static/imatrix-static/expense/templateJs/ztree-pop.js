function check(){var obj={};if(chkStyle&&chkStyle!=""){if(chkboxType&&chkboxType!=""){eval("c="+chkboxType);obj.chkboxType=c}obj.enable=true;obj.chkStyle=chkStyle}return obj}function show(){$("#message").html('<font class="onError"><nobr>\u6ca1\u6709\u67e5\u8be2\u7ed3\u679c!</nobr></font>');$("#message").show();setTimeout('$("#message").hide();',1500)}function getUrl(b,a){var d="";if(typeof(a)!="undefined"&&a!=null){d="currentId="+a.id}else{var d="currentId=0"}return actionUrl+"&"+d}function onClick(b,e,d){if(d){var a=$.fn.zTree.getZTreeObj(ztreeId);a.checkNode(d,null,true);if(d.checked){a.expandNode(d,true,false,true,true)}}currentClickNode=d;currentClickParentNode=d.getParentNode();window.parent.myztreeObj.pCurrentClickNode=currentClickNode;window.parent.myztreeObj.pCurrentClickParentNode=currentClickParentNode}function onCheck(b,e,d){var a=$.fn.zTree.getZTreeObj(ztreeId);if(d){if(d.checked){a.expandNode(d,true,false,true,true)}}}function beforeExpand(b,a){if(a.open){return false}else{return true}}function beforeAsync(){}function onAsyncSuccess(e,g,f,h){if(f){var a=f.children;if(f.checked){for(var b=0;b<a.length;b++){a[b].checked=f.checked;var d=$.fn.zTree.getZTreeObj(ztreeId);d.updateNode(a[b])}}openNode[f.id]=f;ShowSearchNode(a);appendNode(expandNodes)}}function onAsyncError(d,f,e,b,h,g){var a=$.fn.zTree.getZTreeObj(ztreeId);alert("\u5f02\u6b65\u83b7\u53d6\u6570\u636e\u51fa\u73b0\u5f02\u5e38\u3002");a.updateNode(e)}function ShowSearchNode(a){var d=null;if(a){d=a}else{var b=$.fn.zTree.getZTreeObj(ztreeId);d=b.getNodes()}for(var e=0;e<d.length;e++){for(var g in searchMsgs){if(d[e].id==g){d[e].highlight=true;var f=$.fn.zTree.getZTreeObj(ztreeId);f.updateNode(d[e])}}}}function getFontCss(b,a){return(!!a.highlight)?{color:"#FF0000"}:{color:"#333"}}function appendNode(d){for(var a in d){var b=$.fn.zTree.getZTreeObj(ztreeId);var e=b.getNodeByParam("id",a);if(e){b.expandNode(e,true,false,true,true)}}}function onExpand(a,d,b){if(!b.open){openNode[b.id]=b}}function ajaxSearch(){searchMsgs="";expandNodes="";var treeObj=$.fn.zTree.getZTreeObj(ztreeId);var nodes=treeObj.transformToArray(treeObj.getNodes());for(var i=0;i<nodes.length;i++){if(nodes[i].highlight==true){nodes[i].highlight=false;treeObj.updateNode(nodes[i])}}var searchInputValue=$("#searchInput").val();searchInputValue=searchInputValue.replace(/(^\s*)|(\s*$)/g,"");if(searchInputValue==""){return}ShowSearchNode(nodes);$.ajax({data:{searchValue:searchInputValue},cache:false,type:"post",url:searchUrl,success:function(data){if(data!=""){if(data=="[{},{}]"){show();return}if(eval("nodeIds="+data)){expandNodes=nodeIds[0];searchMsgs=nodeIds[1];for(var n in openNode){treeObj.expandNode(openNode[n],false)}appendNode(nodeIds[0]);ShowSearchNode(nodes)}}},error:function(){window.location.reload()}})}var curAsyncCount=0,curStatus="init";function asyncNodes(b){if(!b){return}var d=$.fn.zTree.getZTreeObj(ztreeId);for(var e=0,a=b.length;e<a;e++){if(b[e].isParent&&b[e].zAsync){asyncNodes(b[e].children)}else{d.reAsyncChildNodes(b[e],"refresh",true);curStatus=""}}}function liwai(d){var a=[];if(d.children){a=d.children;for(var b=0;b<a.length;b++){if((a[b].type=="branch"||a[b].type=="department")&&a[b].getCheckStatus().checked&&!a[b].getCheckStatus().half){staticVar.push(a[b]);liwai(a[b])}}}staticVar.push(d)}function getNodeByLevel(a,b){for(var d=0;d<a.length;d++){if(a[d].getCheckStatus().checked){if(!a[d].getCheckStatus().half){if(a[d].type=="branch"||a[d].type=="department"){liwai(a[d])}staticVar.push(a[d])}else{getNodeByLevel(a[d].children,b+1)}}}return staticVar}function getSelectFullNode(e){if(e.getCheckStatus().checked&&!e.getCheckStatus().half){if(e.type!="company"){var d=e.children;if(d){for(var a=0;a<d.length;a++){getSelectFullNode(d[a])}}if(e.type=="branch"){staticVar.push(e)}if(e.type=="workgroup"){staticVar.push(e)}}else{staticVar.push(e)}return}var f=e.children;if(f){for(var b=0;b<f.length;b++){if(f[b].getCheckStatus().checked){if(!f[b].getCheckStatus().half){if(f[b].type=="branch"||f[b].type=="department"){liwai(f[b])}staticVar.push(f[b])}else{getSelectFullNode(f[b])}}else{getSelectFullNode(f[b])}}}}function getTreeType(){if(treeType=="COMPANY"){return 0}else{if(treeType=="MAN_DEPARTMENT_TREE"){return 1}else{if(treeType=="MAN_GROUP_TREE"){return 2}else{if(treeType=="DEPARTMENT_TREE"){return 3}else{if(treeType=="GROUP_TREE"){return 4}else{if(treeType=="DEPARTMENT_WORKGROUP_TREE"){return 5}else{alert("\u51fa\u9519\u4e86!!!")}}}}}}}function _ok_ztree(){var isManTree=getTreeType();var type="type";if(chkStyle=="checkbox"){var zTree=$.fn.zTree.getZTreeObj(ztreeId);var checkNodes=zTree.getCheckedNodes(true);if(checkNodes.length==0){alert("\u8bf7\u9009\u62e9!");return}window.parent.iscollback=true;var treeObj=$.fn.zTree.getZTreeObj(ztreeId);var nodes=treeObj.getNodesByFilter(function filter(obk){return(obk.level==0)});var msg=treeType+"&"+userWithoutDeptVisible+":";var name="";if(isManTree==0||isManTree==1||isManTree==2){staticVar=[];newNodes=getNodeByLevel(nodes,0);var distinct={};var map={};var nameMap={};for(var p=0;p<newNodes.length;p++){distinct[newNodes[p].id]=newNodes[p]}for(var temp in distinct){var arr=temp.split("_");var nodeType=distinct[temp].type;if(nodeType=="hasWorkgroupBranch"){nodeType="workgroup";if(distinct[temp].children){if(!nameMap[nodeType]){nameMap[nodeType]=[];for(var t=0;t<distinct[temp].children.length;t++){nameMap[nodeType].push(distinct[temp].children[t])}}else{for(var t=0;t<distinct[temp].children.length;t++){nameMap[nodeType].push(distinct[temp].children[t])}}}}else{if(!nameMap[nodeType]){nameMap[nodeType]=[];nameMap[nodeType].push(distinct[temp])}else{nameMap[nodeType].push(distinct[temp])}}if(!map[arr[0]]){map[arr[0]]=arr[1]}else{map[arr[0]]=map[arr[0]]+","+arr[1]}}for(var key in map){msg=msg+key+"_"+map[key]+";"}msg=msg.substring(0,msg.length-1)}else{staticVar=[];var map={};for(var i=0;i<checkNodes.length;i++){var arr=checkNodes[i].id.split("_");var key=arr[0];var value=arr[1];if(checkNodes[i].getCheckStatus().half&&(checkNodes[i].type="branch"||checkNodes[i].type=="department")){if(!map.realDepartment){map.realDepartment=arr[1]}else{map.realDepartment=map.realDepartment+","+arr[1]}}}for(var c=0;c<nodes.length;c++){getSelectFullNode(nodes[c])}for(var i=0;i<staticVar.length;i++){var arr=staticVar[i].id.split("_");var key=arr[0];var value=arr[1];var nodeType=staticVar[i].type;if(nodeType=="hasWorkgroupBranch"){nodeType="workgroup";if(staticVar[i].children){for(var t=0;t<staticVar[i].children.length;t++){if(!map[nodeType]){map[nodeType]=staticVar[i].children[t].id.split("_")[1]}else{map[nodeType]=map[nodeType]+","+staticVar[i].children[t].id.split("_")[1]}}}}else{if(!map[arr[0]]){map[arr[0]]=arr[1]}else{map[arr[0]]=map[arr[0]]+","+arr[1]}}}staticVar=[];for(var key in map){msg=msg+key+"_"+map[key]+";"}msg=msg.substring(0,msg.length-1)}$.ajax({data:{msg:msg,showBranch:showBranch,userWithoutDeptVisible:userWithoutDeptVisible},cache:false,type:"post",url:webapp+"/portal/getSelectNodeValue.action",success:function(data){eval(data);if(multiObj){window.parent.multiObj=multiObj;var id="";var name="";if(isManTree==0||isManTree==1||isManTree==2){id=window.parent.ztree.getIds();name=window.parent.ztree.getNames()}else{if(isManTree==3){id=window.parent.ztree.getDepartmentIds();name=window.parent.ztree.getDepartmentNames()}else{if(isManTree==4){id=window.parent.ztree.getWorkGroupIds();name=window.parent.ztree.getWorkGroupNames()}else{if(isManTree==5){id="workgroupIds:"+window.parent.ztree.getWorkGroupIds()+";departmentIds"+window.parent.ztree.getDepartmentIds();name="workgroupIds:"+window.parent.ztree.getWorkGroupNames()+";departmentIds"+window.parent.ztree.getDepartmentNames()}}}}fillMultiValue(multiObj,name,id);window.parent.$.colorbox.close()}},error:function(){window.location.reload()}});return}else{if(currentClickNode==null){alert("\u8bf7\u9009!");return}else{if(treeType=="MAN_DEPARTMENT_TREE"||treeType=="COMPANY"||treeType=="MAN_GROUP_TREE"){if(currentClickNode[type]!="user"){alert("\u8bf7\u9009\u62e9\u4eba\u5458!");return}}else{if(treeType=="DEPARTMENT_TREE"){if(currentClickNode[type]!="department"&&currentClickNode[type]!="branch"){alert("\u8bf7\u9009\u62e9\u90e8\u95e8!");return}}else{if(treeType=="GROUP_TREE"){if(currentClickNode[type]!="workgroup"){alert("\u8bf7\u9009\u62e9\u5de5\u4f5c\u7ec4!");return}}else{if(treeType=="DEPARTMENT_WORKGROUP_TREE"){if(currentClickNode[type]!="department"&&currentClickNode[type]!="branch"&&currentClickNode[type]!="workgroup"){alert("\u8bf7\u9009\u62e9\u90e8\u95e8\u6216\u5de5\u4f5c\u7ec4!");return}}}}}}}window.parent.iscollback=true;fillValue();window.parent.$.colorbox.close()}function fillValue(){eval("obj="+currentClickNode.data);var hiddenMsg=obj.id;var showMsg=obj.name;if(obj[showThing]){showMsg=obj[showThing]}if(obj[hiddenThing]){hiddenMsg=obj[showThing]}if(hiddenInput!=null&&hiddenInput!=""){parent.$("#"+hiddenInput).attr("value",hiddenMsg)}if(showInput!=null&&showInput!=""){parent.$("#"+showInput).attr("value",showMsg)}}function fillMultiValue(f,d,b){var a=b;var e=d;if(treeType=="MAN_DEPARTMENT_TREE"||treeType=="COMPANY"||treeType=="MAN_GROUP_TREE"){if(f.user){if(f.user[showThing]){e=f.user[showThing]}if(f.user[hiddenThing]){a=f.user[hiddenThing]}}}else{if(treeType=="DEPARTMENT_TREE"){if(f.department){if(f.department[showThing]){e=f.department[showThing]}if(f.department[hiddenThing]){a=f.department[hiddenThing]}}}else{if(treeType=="GROUP_TREE"){if(f.workgroup){if(f.workgroup[showThing]){e=f.workgroup[showThing]}if(f.workgroup[hiddenThing]){a=f.workgroup[hiddenThing]}}}else{if(treeType=="DEPARTMENT_WORKGROUP_TREE"){if(f.department){if(f.department[showThing]){e="\u90e8\u95e8:"+f.department[showThing]+";"}if(f.department[hiddenThing]){a="workgroup:"+f.department[hiddenThing]+";"}}if(f.workgroup){if(f.workgroup[showThing]){e=e+"\u5de5\u4f5c\u7ec4:"+f.workgroup[showThing]+";"}if(f.workgroup[hiddenThing]){a=a+"workgroup:"+f.workgroup[hiddenThing]+";"}}}}}}if(hiddenInput!=null&&hiddenInput!=""){parent.$("#"+hiddenInput).attr("value",a)}if(showInput!=null&&showInput!=""){parent.$("#"+showInput).attr("value",e)}}function getClickValueByNode(param){eval("obj="+currentClickNode.data);if(obj){return obj[param]}else{return""}};
