$(document).ready(function(){var a=$("#leafPageId").val();if(a=="true"){$("#tabs").tabs({select:function(b,c){}});$("#"+treeId).attr("type",defaultTreeType);$("#"+defaultTreeType).attr("value",defaultTreeType);$("#"+defaultTreeValue).attr("value",defaultTreeValue);multipleLeafPageTree(defaultTreeType)}else{multipleTree()}});function multipleTree(){$.ajaxSetup({cache:false});$("#"+treeId).jstree({json_data:{ajax:{url:actionUrl,data:function(n){return{currentId:n!=-1?n.attr("id"):0}}}},themes:{theme:"classic",dots:true,icons:true},search:{ajax:{url:searchUrl,async:true,data:function(str){return{searchValue:str}},success:function(data){$("#"+treeId).find("li").find("a").removeClass("jstree-search");var arr=eval(data);for(var i=0;i<arr.length;i++){var deptInfos=arr[i].split(";");var deptInfo=deptInfos[0];var parentInfo=deptInfos[1];var openDeptInfo=deptInfo;if(parentInfo!=""){openDeptInfo=parentInfo}$.jstree._reference($("#"+treeId)).open_node($("li[id='"+openDeptInfo+"']"),function(){for(var j=0;j<arr.length;j++){var jdeptInfos=arr[j].split(";");var jdeptInfo=jdeptInfos[0];var jparentInfo=jdeptInfos[1];if(jparentInfo!=""){$.jstree._reference($("li[id='"+jparentInfo+"']")).open_node($("li[id='"+jdeptInfo+"']"),function(){var result=$("#"+treeId).find("a:contains("+$("#searchInput").attr("value")+")");result.addClass("jstree-search")},true)}}var result=$("#"+treeId).find("a:contains("+$("#searchInput").attr("value")+")");result.addClass("jstree-search")},true)}}}},types:{types:{company:{icon:{image:resourceCtx+"/widgets/jstree/themes/root.gif"}},folder:{icon:{image:resourceCtx+"/widgets/jstree/themes/folder.gif"}},user:{icon:{image:resourceCtx+"/widgets/jstree/themes/file.gif"}},onlineUser:{icon:{image:resourceCtx+"/widgets/jstree/themes/online.gif"}}}},plugins:["themes","json_data","checkbox","types","search"]}).bind("search.jstree",function(e,data){$.jstree.rollback(data.rlbk)})}function search_fun(){$("#"+treeId).jstree("search",$("#searchInput").val())}function allUsers(e){var b=$("#"+e).find("li.jstree-checked");var c="";for(var d=0;d<b.length;d++){c+=$(b[d]).attr("id");if(d!=b.length-1){c+=";"}}if(c!=""){var a=c.split(";");return a}else{return""}}function selectSubDeptUser(a,b){$("#"+treeId).bind("open_node.jstree",function(){var c=$(b).find("li");for(var d=0;d<c.length;d++){selectSubDeptUser(a,$(c[d]).is("li")?$(c[d]):$(c[d]).parent())}$(b).find("li").andSelf().removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");if($(a).data.ui){$(a).data.ui.last_selected=$(b)}$(a).data.checkbox.last_selected=$(b)})}function getInfo(e){var b="user";if(e!=""&&typeof(e)!="undefined"){b=e}var a=allUsers(treeId);if(a!=""){var f="[";if(b=="user"){for(var c=0;c<a.length;c++){var d=a[c].substring(0,a[c].indexOf(split_one));f+='{type:"'+a[c].substring(0,a[c].indexOf(split_one))+'",id:"'+a[c].substring(a[c].indexOf(split_one)+2,a[c].indexOf(split_two))+'",name:"'+a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))+'",loginName:"'+a[c].substring(a[c].indexOf(split_three)+2,a[c].indexOf(split_four))+'",parentType:"'+a[c].substring(a[c].indexOf(split_five)+2,a[c].indexOf(split_eight))+'",parentName:"'+a[c].substring(a[c].indexOf(split_four)+2,a[c].indexOf(split_five))+'",nobranchId:"'+a[c].substring(a[c].indexOf(split_one)+2,a[c].indexOf(split_nine))+'",branchName:"'+a[c].substring(a[c].indexOf(split_nine)+2,a[c].indexOf(split_ten))+'",subCompanyId:"'+a[c].substring(a[c].indexOf(split_ten)+2,a[c].length)+'"},'}}else{if(b=="department"){for(var c=0;c<a.length;c++){var d=a[c].substring(0,a[c].indexOf(split_one));f+='{type:"'+a[c].substring(0,a[c].indexOf(split_one))+'",id:"'+a[c].substring(a[c].indexOf(split_one)+2,a[c].indexOf(split_two))+'",name:"'+a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))+'",branchName:"'+a[c].substring(a[c].indexOf(split_three)+2,a[c].indexOf(split_four))+'",isBranch:"'+a[c].substring(a[c].indexOf(split_four)+2,a[c].indexOf(split_five))+'",subCompanyId:"'+a[c].substring(a[c].indexOf(split_five)+2,a[c].indexOf(split_six))+'",shortTitle:"'+a[c].substring(a[c].indexOf(split_six)+2,a[c].indexOf(split_seven))+'",code:"'+a[c].substring(a[c].indexOf(split_seven)+2,a[c].length)+'"},'}}else{if(b=="workGroup"){for(var c=0;c<a.length;c++){var d=a[c].substring(0,a[c].indexOf(split_one));f+='{type:"'+a[c].substring(0,a[c].indexOf(split_one))+'",id:"'+a[c].substring(a[c].indexOf(split_one)+2,a[c].indexOf(split_two))+'",name:"'+a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))+'",branchName:"'+a[c].substring(a[c].indexOf(split_three)+2,a[c].indexOf(split_four))+'",subCompanyId:"'+a[c].substring(a[c].indexOf(split_four)+2,a[c].length)+'"},'}}else{if(b=="departmentAndGroup"){for(var c=0;c<a.length;c++){var d=a[c].substring(0,a[c].indexOf(split_one));if(d=="department"){f+='{type:"'+a[c].substring(0,a[c].indexOf(split_one))+'",id:"'+a[c].substring(a[c].indexOf(split_one)+2,a[c].indexOf(split_two))+'",name:"'+a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))+'",branchName:"'+a[c].substring(a[c].indexOf(split_three)+2,a[c].indexOf(split_four))+'",isBranch:"'+a[c].substring(a[c].indexOf(split_four)+2,a[c].indexOf(split_five))+'",subCompanyId:"'+a[c].substring(a[c].indexOf(split_five)+2,a[c].length)+'"},'}else{if(d=="workGroup"){f+='{type:"'+a[c].substring(0,a[c].indexOf(split_one))+'",id:"'+a[c].substring(a[c].indexOf(split_one)+2,a[c].indexOf(split_two))+'",name:"'+a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))+'",branchName:"'+a[c].substring(a[c].indexOf(split_three)+2,a[c].indexOf(split_four))+'",subCompanyId:"'+a[c].substring(a[c].indexOf(split_four)+2,a[c].length)+'"},'}}}}}}}if(f.indexOf(",")>=0){f=f.substring(0,f.length-1)}f+="]";window.parent.infor=f;return f}else{return""}}function getInfoWithTreeId(){var a=allUsers(treeId);if(a!=""){var c="[";for(var b=0;b<a.length;b++){type=a[b].substring(0,a[b].indexOf(split_one));c+='{type:"'+a[b].substring(0,a[b].indexOf(split_one))+'",id:"'+a[b].substring(a[b].indexOf(split_one)+2,a[b].indexOf(split_two))+'",name:"'+a[b].substring(a[b].indexOf(split_two)+2,a[b].indexOf(split_three))+'",loginName:"'+a[b].substring(a[b].indexOf(split_three)+2,a[b].indexOf(split_eight))+'"},'}if(c.indexOf(",")>=0){c=c.substring(0,c.length-1)}c+="]";return c}else{return""}}function changeSelected(a,b){$("#defaultTreeType").attr("value",a);$("#defaultTreeValue").attr("value",b);$("#"+treeId).attr("type",a);multipleLeafPageTree(a)}function multipleLeafPageTree(type){$.ajaxSetup({cache:false});$("#"+treeId).bind("search.jstree",function(e,data){$.jstree.rollback(data.rlbk)}).jstree({json_data:{ajax:{url:actionUrl+"?treeType="+type,data:function(n){return{currentId:n!=-1?n.attr("id"):0}}}},themes:{theme:"classic",dots:true,icons:true},search:{ajax:{url:searchUrl+"?treeType="+type,async:true,data:function(str){return{searchValue:str}},success:function(data){$("#"+treeId).find("li").find("a").removeClass("jstree-search");var arr=eval(data);for(var i=0;i<arr.length;i++){var deptInfos=arr[i].split(";");var deptInfo=deptInfos[0];var parentInfo=deptInfos[1];var openDeptInfo=deptInfo;if(parentInfo!=""){openDeptInfo=parentInfo}$.jstree._reference($("#"+treeId)).open_node($("li[id="+openDeptInfo+"]"),function(){for(var j=0;j<arr.length;j++){var jdeptInfos=arr[j].split(";");var jdeptInfo=jdeptInfos[0];var jparentInfo=jdeptInfos[1];if(jparentInfo!=""){$.jstree._reference($("li[id="+jparentInfo+"]")).open_node($("li[id="+jdeptInfo+"]"),function(){var result=$("#"+treeId).find("a:contains("+$("#"+inputId).attr("value")+")");result.addClass("jstree-search")},true)}}var result=$("#"+treeId).find("a:contains("+$("#"+inputId).attr("value")+")");result.addClass("jstree-search")},true)}}}},types:{types:{company:{icon:{image:ctx+"/widgets/jstree/themes/root.gif"}},folder:{icon:{image:ctx+"/widgets/jstree/themes/folder.gif"}},user:{icon:{image:ctx+"/widgets/jstree/themes/file.gif"}}}},plugins:["themes","json_data","checkbox","types","search"]})}function getIds(){var a=allUsers(treeId);var d="";for(var b=0;b<a.length;b++){var e=a[b].substring(a[b].indexOf(split_one)+2,a[b].indexOf(split_two));var c=a[b].substring(0,a[b].indexOf(split_one));if(c=="user"&&!isContain(e,d)){d+=a[b].substring(a[b].indexOf(split_one)+2,a[b].indexOf(split_two))+","}}window.parent.mId=d.substring(0,d.length-1);return d.substring(0,d.length-1)}function getNames(){var a=allUsers(treeId);var e="";for(var c=0;c<a.length;c++){var b="";if(isSingleCompany=="true"){b=a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))+"("+a[c].substring(a[c].indexOf(split_nine)+2,a[c].indexOf(split_ten))+")"}else{b=a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))}var d=a[c].substring(0,a[c].indexOf(split_one));if(d=="user"&&!isContain(b,e)){if(isSingleCompany=="true"){e+=b+","}}}window.parent.mName=e.substring(0,e.length-1);return e.substring(0,e.length-1)}function getTypes(){var a=allUsers(treeId);var c="";for(var b=0;b<a.length;b++){c+=a[b].substring(0,a[b].indexOf(split_one))+","}window.parent.mType=c.substring(0,c.length-1);return c.substring(0,c.length-1)}function getTreeType(){var a=$("#defaultTreeType").val();window.parent.mTreeType=a;return a}function getLoginNames(){var f=$("#isAppend").val();var j=$("#loginNameId").val();var d=allUsers(treeId);var b="";for(var c=0;c<d.length;c++){var e=d[c].substring(0,d[c].indexOf(split_one));if(e=="user"){var h=d[c].substring(d[c].indexOf(split_three)+2,d[c].indexOf(split_four));if(b.indexOf(h+",")<0){b+=h+","}}}var g="";if(f=="true"&&j!="noLoginName"&&j!="undefined"){var a=window.parent.$("#"+j).val();if(a!=""){g=removeRepeate(a,b.substring(0,b.length-1),",")}else{g=getNoRepeatLoginName(b.substring(0,b.length-1))}}else{g=getNoRepeatLoginName(b.substring(0,b.length-1))}window.parent.mLoginName=g;return g}function getUserInfoWithTreeId(){var a=allUsers(treeId);if(a!=""){var c="[";for(var b=0;b<a.length;b++){type=a[b].substring(0,a[b].indexOf(split_one));if(type=="user"){c+='{type:"'+a[b].substring(0,a[b].indexOf(split_one))+'",id:"'+a[b].substring(a[b].indexOf(split_one)+2,a[b].indexOf(split_two))+'",name:"'+a[b].substring(a[b].indexOf(split_two)+2,a[b].indexOf(split_three))+'",loginName:"'+a[b].substring(a[b].indexOf(split_three)+2,a[b].indexOf(split_four))+'",parentName:"'+a[b].substring(a[b].indexOf(split_five)+2,a[b].indexOf(split_six))+'",parentId:"'+a[b].substring(a[b].indexOf(split_six)+2,a[b].indexOf(split_eight))+'",branchName:"'+a[b].substring(a[b].indexOf(split_nine)+2,a[b].indexOf(split_ten))+'",subCompanyId:"'+a[b].substring(a[b].indexOf(split_ten)+2,a[b].length)+'"},'}}if(c.indexOf(",")>=0){c=c.substring(0,c.length-1)}c+="]";window.parent.userInfo=c;return c}else{return""}}function getDepartmentNames(){var a=allUsers(treeId);var e="";for(var c=0;c<a.length;c++){var d=a[c].substring(0,a[c].indexOf(split_one));var b="";if(isSingleCompany=="true"&&a[c].substring(a[c].indexOf(split_four)+2,a[c].indexOf(split_five))=="false"){b=a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))+"("+a[c].substring(a[c].indexOf(split_three)+2,a[c].indexOf(split_four))+")"}else{b=a[c].substring(a[c].indexOf(split_two)+2,a[c].indexOf(split_three))}if(d=="department"){e+=b+","}}window.parent.mDepartmentName=e.substring(0,e.length-1);return e.substring(0,e.length-1)}function getDepartmentIds(){var a=allUsers(treeId);var d="";for(var b=0;b<a.length;b++){var c=a[b].substring(0,a[b].indexOf(split_one));if(c=="department"){d+=a[b].substring(a[b].indexOf(split_one)+2,a[b].indexOf(split_two))+","}}window.parent.mDepartmentId=d.substring(0,d.length-1);return d.substring(0,d.length-1)}function getDepartmentCodes(){var a=allUsers(treeId);var c="";for(var b=0;b<a.length;b++){var d=a[b].substring(0,a[b].indexOf(split_one));if(d=="department"){c+=a[b].substring(a[b].indexOf(split_seven)+2,a[b].length)+","}}window.parent.departmentCodes=c.substring(0,c.length-1);return c.substring(0,c.length-1)}function getDepartmentShortTitles(){var a=allUsers(treeId);var d="";for(var b=0;b<a.length;b++){var c=a[b].substring(0,a[b].indexOf(split_one));if(c=="department"){d+=a[b].substring(a[b].indexOf(split_six)+2,a[b].indexOf(split_seven))+","}}window.parent.departmentShortTitles=d.substring(0,d.length-1);return d.substring(0,d.length-1)}function getWorkGroupNames(){var a=allUsers(treeId);var d="";for(var b=0;b<a.length;b++){var c=a[b].substring(0,a[b].indexOf(split_one));var e="";if(isSingleCompany=="true"){e=a[b].substring(a[b].indexOf(split_two)+2,a[b].indexOf(split_three))+"("+a[b].substring(a[b].indexOf(split_three)+2,a[b].indexOf(split_four))+")"}else{e=a[b].substring(a[b].indexOf(split_two)+2,a[b].indexOf(split_three))}if(c=="workGroup"){d+=e+","}}window.parent.mWorkGroupName=d.substring(0,d.length-1);return d.substring(0,d.length-1)}function getWorkGroupIds(){var a=allUsers(treeId);var c="";for(var b=0;b<a.length;b++){var d=a[b].substring(0,a[b].indexOf(split_one));if(d=="workGroup"){c+=a[b].substring(a[b].indexOf(split_one)+2,a[b].indexOf(split_two))+","}}window.parent.mWorkGroupId=c.substring(0,c.length-1);return c.substring(0,c.length-1)}function getAllIds(){var isAppend=$("#isAppend").val();var info=getInfo("user");var users=eval(info);var ids=getBranchId(users,"departmentAndGroup",isAppend);var arr=ids.split(";");for(var i=0;i<arr.length;i++){var temp=arr[i].split("-");if(temp[0]=="department"){window.parent.mDepartmentId=temp[1]}else{if(temp[0]=="workgroup"){window.parent.mWorkGroupId=temp[1]}}}return ids}function getEmails(){var a=allUsers(treeId);var e="";for(var c=0;c<a.length;c++){var b=a[c].substring(a[c].indexOf(split_one)+2,a[c].indexOf(split_two));var d=a[c].substring(0,a[c].indexOf(split_one));if(d=="user"&&e.indexOf(b+",")<0){e+=a[c].split(split_eight)[1].split(split_seven)[0]+","}}window.parent.mEmail=e.substring(0,e.length-1);return e.substring(0,e.length-1)}function getHonorificNames(){var b=allUsers(treeId);var a="";for(var c=0;c<b.length;c++){var e=b[c].substring(b[c].indexOf(split_one)+2,b[c].indexOf(split_two));var d=b[c].substring(0,b[c].indexOf(split_one));if(d=="user"&&a.indexOf(e+",")<0){a+=b[c].split(split_eight)[1].split(split_seven)[1]+","}}window.parent.mHonorificName=a.substring(0,a.length-1);return a.substring(0,a.length-1)}function getWeights(){var a=allUsers(treeId);var d="";for(var b=0;b<a.length;b++){var e=a[b].substring(a[b].indexOf(split_one)+2,a[b].indexOf(split_two));var c=a[b].substring(0,a[b].indexOf(split_one));if(c=="user"&&d.indexOf(e+",")<0){d+=a[b].split(split_eight)[1].split(split_seven)[2]+","}}window.parent.mWeight=d.substring(0,d.length-1);return d.substring(0,d.length-1)}function getNoRepeatLoginName(d){var b=d.split(",");var a="";for(var c=0;c<b.length;c++){if(!isContain(b[c],a)){a+=b[c]+","}}return a.substring(0,a.length-1)}function returnParamater(c,b){var a="";if(b=="id"){a=c.id}else{if(b=="name"){a=c.name}else{if(b=="loginName"){a=c.loginName}else{if(b=="email"){a=c.email}else{if(b=="parentName"){a=c.parentName}else{if(b=="parentId"){a=c.parentId}else{if(b=="parentType"){a=c.parentType}}}}}}}return a}function createValueStr(e,b){var a="";var c=b.split(",");var f="";for(var d=0;d<c.length;d++){a+=c[d]+"="+returnParamater(e,c[d])+","}return a.substring(0,a.length-1)}function createValueStrSingle(c,a){if(a==""){return returnParamater(c,id)}else{var b=a.split(",");return returnParamater(c,b[0])}}function removeRepeate(b,e,g){var f=e.split(g);var a="";var d="";for(var c=0;c<f.length;c++){if(!isHasId(b,f[c])){d+=f[c]+g}}a=b+g+d;return a.substring(0,a.length-1)}function removeRepeateId(b,f,h){var g=f.split(h);var a="";var e="";for(var d=0;d<g.length;d++){var c=g[d].split("=")[1];if(!isHasId(b,c)){e+=c+","}}a=b+","+e;return a.substring(0,a.length-1)}function getNoRepeatIdAndName(a,b){result=a+split_night+b;return result}function removeRepeateDepartmentAndGroupId(a,c){var g=a.split(split_five)[0].split("==")[1];var b=a.split(split_five)[1].split("==")[1];var h="";var f="";if(typeof(g)!="undefined"){var e=c.split(split_five)[0].split("==")[1].split(",");for(var d=0;d<e.length;d++){if(!isHasId(g,e[d])){if(g!=""){g+=","+e[d]}else{g+=e[d]+","}}}if(g.substring(g.length-1,g.length)!=","){h="departmentIds=="+g}else{h="departmentIds=="+g.substring(0,g.length-1)}}else{h="departmentIds=="}if(typeof(b)!="undefined"){var e=c.split(split_five)[1].split("==")[1].split(",");for(var d=0;d<e.length;d++){if(!isHasId(b,e[d])){if(b!=""){b+=","+e[d]}else{b+=e[d]+","}}}if(b.substring(b.length-1,b.length)!=","){f="groupIds=="+b}else{f="groupIds=="+b.substring(0,b.length-1)}}else{f="groupIds=="}return h+split_five+f}function isHasId(a,b){var c=a.split(",");for(i=0;i<c.length;i++){if(c[i]==b){return true}}return false}function isContain(e,d){var c=d.split(",");var a=false;for(var b=0;b<c.length;b++){if(e==c[b]){a=true;break}}return a}function translateId(c){var b=c.split(";");var a="";for(i=0;i<b.length;i++){a+=b[i].split("=")[1]+","}return a.substring(0,a.length-1)}function translateDepartmentAndGroupId(g){var e=g.split(split_five)[0].split("==")[1];var b=g.split(split_five)[1].split("==")[1];var f="";var d="";if(typeof(e)!="undefined"&&e!=""){var h=e.split(";");for(var c=0;c<h.length;c++){f+=h[c].split("=")[1]+","}f="departmentIds=="+f.substring(0,f.length-1)}else{f="departmentIds=="}if(typeof(b)!="undefined"&&b!=""){var a=b.split(";");for(var c=0;c<a.length;c++){d+=a[c].split("=")[1]+","}d="groupIds=="+d.substring(0,d.length-1)}else{d="groupIds=="}return f+split_five+d}function isWholeCompany(c){for(var a=0;a<c.length;a++){var b=c[a].type;if(b=="company"){return true}}return false}function isWholeDepartment(c){for(var a=0;a<c.length;a++){var b=c[a].type;if(b=="allDepartment"){return true}}return false}function isWholeWorkGroup(d){var a=false;for(var b=0;b<d.length;b++){var c=d[b].type;if(c=="allWorkGroup"){a=true}if(c=="user"){a=false;break}}return a}function isWholeWorkGroupAndMan(e){var c=false;var a=false;for(var b=0;b<e.length;b++){var d=e[b].type;if(d=="allWorkGroup"){c=true}if(d=="user"){a=true}}return c&&a}function isWholeBranch(c){for(var a=0;a<c.length;a++){var b=c[a].type;if(b=="branch"){return true}}return false}function getBranchId(d,b,c){var a=handleNodeFromTree(d,b);var e=getValueFromSomeWhere("HIDDEN");if(c!="true"||e==""){return combineResult(a)}else{return getAppendResult(e,a)}}function getAppendResult(b,c){var a=rebackSplitIds(b,c)+","+c;return combineResult(a)}function rebackSplitIds(f,k){var l="";var d=f.split(";");for(var c=0;c<d.length;c++){var a=d[c].split("-");var g=d[c].split("-")[0];if(a.length==2){var e=d[c].split("-")[1].split(",");for(var b=0;b<e.length;b++){var h=g+"-"+e[b];if(!isContain(h,k)&&e[b]!=""){l+=h+","}}}}return l.substring(0,l.length-1)}function handleNodeFromTree(e,d){var a="";for(var b=0;b<e.length;b++){var c=e[b].type;if(c=="branch"){if(d=="MAN_DEPARTMENT_TREE"){a+="branchonlydepartment-"+e[b].id+","}else{if(d=="MAN_GROUP_TREE"){a+="branchonlyworkgroup-"+e[b].id+","}else{if(d!="DEPARTMENT_TREE"&&d!="GROUP_TREE"){a+="branch-"+e[b].id+","}}}}else{if(c=="allDepartment"){a+="branchalldepartment-"+e[b].id+","}else{if(c=="allWorkGroup"){a+="branchallworkgroup-"+e[b].id+","}else{if(c=="user"){a+="user-"+e[b].id+","}else{if(c=="NOBRANCH"){a+="nobranch-"+e[b].nobranchId+","}else{if(c=="department"){a+="department-"+e[b].id+","}else{if(c=="workGroup"){a+="workgroup-"+e[b].id+","}}}}}}}}return a.substring(0,a.length-1)}function combineResult(r){var x="";var j="";var B="";var z="";var C="";var c="";var h="";var m="";var v="";var a=r.split(",");for(var t=0;t<a.length;t++){var e=a[t].split("-")[0];var o=a[t].split("-")[1];if(e=="branch"){x+=o+","}else{if(e=="branchalldepartment"){if(!isContain("branch-"+o,r)){j+=o+","}}else{if(e=="branchallworkgroup"){if(!isContain("branch-"+o,r)){B+=o+","}}else{if(e=="user"){z+=o+","}else{if(e=="branchonlydepartment"){C+=o+","}else{if(e=="branchonlyworkgroup"){c+=o+","}else{if(e=="nobranch"){h+=o+","}else{if(e=="department"){m+=o+","}else{if(e=="workgroup"){v+=o+","}}}}}}}}}}var A=x==""?"":x.substring(0,x.length-1);var y=j==""?"":j.substring(0,j.length-1);var l=B==""?"":B.substring(0,B.length-1);var n=z==""?"":z.substring(0,z.length-1);var q=C==""?"":C.substring(0,C.length-1);var f=c==""?"":c.substring(0,c.length-1);var s=h==""?"":h.substring(0,h.length-1);var p=m==""?"":m.substring(0,m.length-1);var g=v==""?"":v.substring(0,v.length-1);var k="branch-"+A+";branchalldepartment-"+y+";branchallworkgroup-"+l+";user-"+n+";branchonlydepartment-"+q+";branchonlyworkgroup-"+f+";nobranch-"+s+";department-"+p+";workgroup-"+g;return k}function getBranchName(c,b){var a=getValueFromSomeWhere("SHOW");if(b!="true"||a==""){return getBranchNameNoAppend(c)}else{return getBranchNameAppend(a,c)}}function getBranchNameAppend(d,f){for(var c=0;c<f.length;c++){var e=f[c].type;var a=f[c].branchName;if((e=="allDepartment"||e=="allWorkGroup"||e=="user")&&a!="null"){if(!isContain(f[c].name+"("+f[c].branchName+")",d)){d+=","+f[c].name+"("+f[c].branchName+")"}}else{if(e=="NOBRANCH"){if(!isContain("\u65e0\u90e8\u95e8\u4eba\u5458("+a+")",d)){if(a!="null"){d+=",\u65e0\u90e8\u95e8\u4eba\u5458("+a+")"}else{d+=",\u65e0\u90e8\u95e8\u4eba\u5458"}}}else{if(e=="department"){var b=users[c].isBranch;if(!isContain(f[c].name,d)){if(a!="null"){if(b!="true"){d+=","+f[c].name+"("+a+")"}else{d+=","+f[c].name}}else{d+=","+f[c].name}}}else{if(!isContain(f[c].name,d)){if(a!="null"){d+=","+f[c].name+"("+a+")"}else{d+=","+f[c].name}}}}}}return d}function getBranchNameNoAppend(f){var b="";for(var d=0;d<f.length;d++){var e=f[d].type;var a=f[d].branchName;if((e=="allDepartment"||e=="allWorkGroup"||e=="user")&&a!="null"){if(!isContain(f[d].name+"("+f[d].branchName+")",b)){b+=f[d].name+"("+f[d].branchName+"),"}}else{if(e=="NOBRANCH"){if(!isContain("\u65e0\u90e8\u95e8\u4eba\u5458("+a+")",b)){if(a!="null"){b+="\u65e0\u90e8\u95e8\u4eba\u5458("+a+"),"}else{b+="\u65e0\u90e8\u95e8\u4eba\u5458,"}}}else{if(e=="department"){var c=f[d].isBranch;if(!isContain(f[d].name,b)){if(a!="null"&&e!="branch"){if(c!="true"){b+=f[d].name+"("+a+"),"}else{b+=f[d].name+","}}else{b+=f[d].name+","}}}else{if(!isContain(f[d].name,b)){if(a!="null"&&e!="branch"){b+=f[d].name+"("+a+"),"}else{b+=f[d].name+","}}}}}}return b.substring(0,b.length-1)}function fulfillInput(d,a){var c=$("#hiddenInputId").val();var b=$("#showInputId").val();var f=$("#formId").val();var e=$("#mode").val();if(a=="HIDDEN"){if(c=="NOHiddenInputId"||e=="parent"){if(f=="noFormId"){alert("\u8bf7\u8bbe\u7f6eformId!")}window.parent.$("#builtInInput").attr("value",d)}else{window.parent.$("#"+c).attr("value",d)}}else{if(a=="SHOW"){if(b=="NOShowInputId"||e=="parent"){if(f=="noFormId"){alert("\u8bf7\u8bbe\u7f6eformId!")}window.parent.$("#builtInShowInput").attr("value",d)}else{window.parent.$("#"+b).attr("value",d)}}}}function getValueFromSomeWhere(a){var c=$("#hiddenInputId").val();var b=$("#showInputId").val();var e=$("#formId").val();var d=$("#mode").val();if(a=="HIDDEN"){if(c=="NOHiddenInputId"||d=="parent"){if(e=="noFormId"){alert("\u8bf7\u8bbe\u7f6eformId!")}return window.parent.$("#builtInInput").val()}else{if(window.parent.$("#"+c).attr("id")==c){return window.parent.$("#"+c).val()}else{return"\u4fdd\u5b58\u503c\u7684\u6587\u672c\u6846\u4e0d\u5b58\u5728!"}}}else{if(a=="SHOW"){if(b=="NOShowInputId"||d=="parent"){if(e=="noFormId"){alert("\u8bf7\u8bbe\u7f6eformId!")}return window.parent.$("#builtInShowInput").val()}else{if(window.parent.$("#"+b).attr("id")==b){return window.parent.$("#"+b).val()}else{return"\u663e\u793a\u503c\u7684\u6587\u672c\u6846\u4e0d\u5b58\u5728!"}}}}}function selectMan(treeValue,treeType){var isAppend=$("#isAppend").val();var info=getInfo("user");if(info!=""&&info!="[]"){var users=eval(info);if(users!=""){if(branchIds=="ADMIN"){if(!isWholeCompany(users)&&!isWholeDepartment(users)&&!isWholeWorkGroup(users)){if(isNoUser(users)){alert("\u8bf7\u9009\u62e9\u4eba\u5458")}else{getUserInfo(users,treeValue,isAppend)}}else{if(isWholeDepartment(users)&&!isWholeCompany(users)&&!isWholeWorkGroup(users)){if(treeType!="COMPANY"&&treeType!="MAN_DEPARTMENT_GROUP_TREE"){fulfillInput("ALLCOMPANYID","HIDDEN");fulfillInput("\u6240\u6709\u90e8\u95e8\u4eba\u5458","SHOW")}else{alert("\u8bf7\u9009\u62e9\u5177\u4f53\u4eba\u5458")}}else{if(isWholeWorkGroup(users)&&!isWholeCompany(users)&&!isWholeDepartment(users)){if(treeType!="COMPANY"&&treeType!="MAN_DEPARTMENT_GROUP_TREE"){fulfillInput("ALLWORKGROUP","HIDDEN");fulfillInput("\u6240\u6709\u5de5\u4f5c\u7ec4\u4eba\u5458","SHOW")}else{alert("\u8bf7\u9009\u62e9\u5177\u4f53\u4eba\u5458")}}else{fulfillInput("ALLCOMPANYID","HIDDEN");fulfillInput("\u6240\u6709\u4eba\u5458","SHOW")}}}}else{var branchCombineIds=getBranchId(users,treeType,isAppend);if(isNoSelectUser(branchCombineIds)){alert("\u8bf7\u9009\u62e9\u4eba\u5458")}else{fulfillInput(branchCombineIds,"HIDDEN");fulfillInput(getNames(),"SHOW")}}}else{alert("\u8bf7\u9009\u62e9\u6b63\u786e\u7684\u8282!")}}else{alert("\u8bf7\u9009\u62e9\u4eba\u5458")}}function isNoUser(c){for(var a=0;a<c.length;a++){var b=c[a].type;if(b=="user"){return false}}return true}function selectManGroup(treeValue,treeType){var isAppend=$("#isAppend").val();var info=getInfo("user");if(info!=""&&info!="[]"){var users=eval(info);if(users!=""){if(branchIds=="ADMIN"){if(!isWholeCompany(users)&&!isWholeDepartment(users)&&!isWholeWorkGroup(users)){getUserInfo(users,treeValue,isAppend)}else{fulfillInput("ALLCOMPANYID","HIDDEN");fulfillInput("\u6240\u6709\u4eba\u5458","SHOW")}}else{var branchCombineIds=getBranchId(users,treeType,isAppend);if(isNoSelectUser(branchCombineIds)){alert("\u8bf7\u9009\u62e9\u4eba\u5458")}else{fulfillInput(branchCombineIds,"HIDDEN");fulfillInput(getBranchName(users,isAppend),"SHOW")}}}else{alert("\u8bf7\u9009\u62e9\u6b63\u786e\u7684\u8282!")}}else{alert("\u8bf7\u9009\u62e9\u4eba\u5458")}}function isNoSelectUser(g){var a=g.split(";");var d="";var f="";for(var b=0;b<a.length;b++){var e=a[b].split("-");var c=a[b].split("-")[0];if(e.length==2){if(c=="user"){f=a[b].split("-")[1]}else{if(c=="department"){d=a[b].split("-")[1]}}}}if(d!=""&&f==""){return true}return false}function getUserInfo(c,e,m){var a="";var k="";for(var f=0;f<c.length;f++){var l=c[f].type;if(l=="user"){var d=createValueStr(c[f],e);var h=c[f].branchName;var b="";if(isSingleCompany=="true"){b=c[f].name+"("+h+")"}else{b=c[f].name}if(!isContain(d,a)){a+=d+";"}if(!isContain(b,k)){k+=b+","}}}var g=a.substring(0,a.length-1);if(g!=""){if(m!="true"){var o=getNoRepeatIdAndName(translateId(g),k.substring(0,k.length-1));fulfillInput(o.split(split_night)[0],"HIDDEN");fulfillInput(o.split(split_night)[1],"SHOW")}else{var j=getValueFromSomeWhere("HIDDEN");var n=getValueFromSomeWhere("SHOW");if(j!=""){fulfillInput(removeRepeateId(j,g,";"),"HIDDEN");fulfillInput(removeRepeate(n,k.substring(0,k.length-1),","),"SHOW")}else{var o=getNoRepeatIdAndName(translateId(g),k.substring(0,k.length-1));fulfillInput(o.split(split_night)[0],"HIDDEN");fulfillInput(o.split(split_night)[1],"SHOW")}}}}function selectDepartment(treeValue,treeType){var isAppend=$("#isAppend").val();var info=getInfo("department");if(info!=""&&info!="[]"){var users=eval(info);if(users!=""){if(branchIds=="ADMIN"){if(!isWholeCompany(users)&&!isWholeDepartment(users)){getDepartmentInfo(users,treeValue,isAppend)}else{fulfillInput("ALLCOMPANYID","HIDDEN");fulfillInput("\u6240\u6709\u90e8\u95e8","SHOW")}}else{fulfillInput(getBranchId(users,treeType,isAppend),"HIDDEN");fulfillInput(getDepartmentNames(),"SHOW")}}else{alert("\u8bf7\u9009\u62e9\u6b63\u786e\u7684\u8282!");return}}else{alert("\u8bf7\u9009\u62e9\u90e8\u95e8");return}}function getDepartmentInfo(c,e,n){var a="";var l="";for(var g=0;g<c.length;g++){var m=c[g].type;if(m=="department"){var d=createValueStr(c[g],e);var j=c[g].branchName;var f=c[g].isBranch;var b="";if(isSingleCompany=="true"){if(f!="true"){b=c[g].name+"("+j+")"}else{b=c[g].name}}else{b=c[g].name}if(!isContain(d,a)){a+=d+";"}if(!isContain(b,l)){l+=b+","}}}var h=a.substring(0,a.length-1);if(h!=null){if(n!="true"){var p=getNoRepeatIdAndName(translateId(h),l.substring(0,l.length-1));fulfillInput(p.split(split_night)[0],"HIDDEN");fulfillInput(p.split(split_night)[1],"SHOW")}else{var k=getValueFromSomeWhere("HIDDEN");var o=getValueFromSomeWhere("SHOW");if(k!=""){fulfillInput(removeRepeateId(k,h,";"),"HIDDEN");fulfillInput(removeRepeate(o,l.substring(0,l.length-1),","),"SHOW")}else{var p=getNoRepeatIdAndName(translateId(h),l.substring(0,l.length-1));fulfillInput(p.split(split_night)[0],"HIDDEN");fulfillInput(p.split(split_night)[1],"SHOW")}}}}function selectWorkGroup(treeValue,treeType){var isAppend=$("#isAppend").val();var info=getInfo("workGroup");if(info!=""&&info!="[]"){var users=eval(info);if(users!=""){if(branchIds=="ADMIN"){if(!isWholeCompany(users)&&!isWholeWorkGroup(users)){getWorkGroupInfo(users,treeValue,isAppend)}else{fulfillInput("ALLCOMPANYID","HIDDEN");fulfillInput("\u6240\u6709\u5de5\u4f5c\u7ec4","SHOW")}}else{fulfillInput(getBranchId(users,treeType,isAppend),"HIDDEN");fulfillInput(getWorkGroupNames(),"SHOW")}}else{alert("\u8bf7\u9009\u62e9\u6b63\u786e\u7684\u8282!");return}}else{alert("\u8bf7\u9009\u62e9\u5de5\u4f5c\u7ec4");return}}function getWorkGroupInfo(c,e,m){var a="";var k="";for(var f=0;f<c.length;f++){var l=c[f].type;if(l=="workGroup"){var d=createValueStr(c[f],e);var h=c[f].branchName;var b="";if(isSingleCompany=="true"){b=c[f].name+"("+h+")"}else{b=c[f].name}if(!isContain(d,a)){a+=d+";"}if(!isContain(b,k)){k+=b+","}}}var g=a.substring(0,a.length-1);if(g!=null){if(m!="true"){var o=getNoRepeatIdAndName(translateId(g),k.substring(0,k.length-1));fulfillInput(o.split(split_night)[0],"HIDDEN");fulfillInput(o.split(split_night)[1],"SHOW")}else{var j=getValueFromSomeWhere("HIDDEN");var n=getValueFromSomeWhere("SHOW");if(j!=""){fulfillInput(removeRepeateId(j,g,";"),"HIDDEN");fulfillInput(removeRepeate(n,k.substring(0,k.length-1),","),"SHOW")}else{var o=getNoRepeatIdAndName(translateId(g),k.substring(0,k.length-1));fulfillInput(o.split(split_night)[0],"HIDDEN");fulfillInput(o.split(split_night)[1],"SHOW")}}}}function selectDepartmentAndWorkGroup(treeValue,treeType){var isAppend=$("#isAppend").val();var info=getInfo("departmentAndGroup");if(info!=""&&info!="[]"){var users=eval(info);if(users!=""){if(!isWholeCompany(users)&&!isWholeDepartment(users)&&!isWholeWorkGroup(users)){fulfillInput(getBranchId(users,treeType,isAppend),"HIDDEN");fulfillInput(getBranchName(users,isAppend),"SHOW")}else{if(isWholeDepartment(users)){fulfillInput("ALLCOMPANYID","HIDDEN");fulfillInput("\u6240\u6709\u4eba\u5458","SHOW")}else{if(isWholeWorkGroup(users)){fulfillInput("ALLWORKGROUP","HIDDEN");fulfillInput("\u6240\u6709\u5de5\u4f5c\u7ec4","SHOW")}else{fulfillInput("ALLCOMPANYID","HIDDEN");fulfillInput("\u6240\u6709\u4eba\u5458","SHOW")}}}}else{alert("\u8bf7\u9009\u62e9\u6b63\u786e\u7684\u8282!");return}}else{alert("\u8bf7\u9009\u62e9\u90e8\u95e8\u6216\u5de5\u4f5c\u7ec4");return}}function _ok_tree(){var c=$("#defaultTreeType").val();var a=$("#defaultTreeValue").val();var e=$("#formId").val();var d=$("#mode").val();if(e!="noFormId"){window.parent.$("#"+e).append("<input id='builtInInput' type='hidden' value='' >").append("<input id='builtInShowInput' type='hidden' value='' >")}if(c=="COMPANY"||c=="MAN_DEPARTMENT_GROUP_TREE"||c=="MAN_DEPARTMENT_TREE"){selectMan(a,c)}else{if(c=="MAN_GROUP_TREE"){selectManGroup(a,c)}else{if(c=="DEPARTMENT_TREE"){selectDepartment(a,c)}else{if(c=="GROUP_TREE"){selectWorkGroup(a,c)}else{if(c=="DEPARTMENT_WORKGROUP_TREE"){selectDepartmentAndWorkGroup(a,c)}}}}}var b=getValueFromSomeWhere("HIDDEN");if(typeof b=="undefined"||b==""){return}else{if(b=="\u4fdd\u5b58\u503c\u7684\u6587\u672c\u6846\u4e0d\u5b58\u5728!"||b=="\u663e\u793a\u503c\u7684\u6587\u672c\u6846\u4e0d\u5b58\u5728!"){alert(b)}else{getIds();getNames();getInfo();getEmails();getNames();getLoginNames();getWeights();getHonorificNames();getTypes();getTreeType();getUserInfoWithTreeId();getDepartmentNames();getDepartmentCodes();getDepartmentShortTitles();getDepartmentIds();getWorkGroupNames();getWorkGroupIds();getAllIds();window.parent.okEnsure="OK";if(d!="parent"){window.parent.$.colorbox.close()}}}if(d=="parent"){parent.openMessage(getValueFromSomeWhere("HIDDEN"),getValueFromSomeWhere("SHOW"))}};
