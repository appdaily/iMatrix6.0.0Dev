$(document).ready(function(){var b=parent._obj.url+"?"+parent._url_prn;parent._crn_obj=parent._obj;if(typeof(parent._obj.tree)!="undefined"){$("#btnDiv").html('<div class="opt-btn"><button class="btn" onclick="_ok();"><span><span>\u786e\u5b9a</span></span></button></div>');var d="<ul>";var c=0;for(var f in parent._obj.tree){c++;var h=parent._obj.tree[f];if(c==1){parent._crn_obj=h;var e=h.url;if(parent._crn_obj.url.indexOf("?")>=0){var g=parent._crn_obj.url.split("?");e=g[0]}var a=_get_url_parameter();b=e+"?"+a}d+='<li><a href="#tabs-1" onclick="__changeViewSet(\''+f+"');\">"+f+"</a></li>"}d+="</ul>";$("#tagDiv").html(d);$("#tabs").tabs()}else{if(!parent._crn_obj.mutiple){_jstree_single_bind_select()}}if(parent._crn_obj.multiple){$("#btnDiv").html('<div class="opt-btn"><button class="btn" onclick="_ok();"><span><span>\u786e\u5b9a</span></span></button></div>')}if(parent._obj.treeType=="jstree"){__create_tree(b)}else{__create_ztree(b)}});function __changeViewSet(d){parent._crn_obj=parent._obj.tree[d];var b="";var c=parent._crn_obj.url;if(parent._crn_obj.url.indexOf("?")>=0){var e=parent._crn_obj.url.split("?");c=e[0]}var a=_get_url_parameter();b=c+"?"+a;if(parent._obj.treeType=="jstree"){__create_tree(b)}else{__create_ztree(b)}}function __create_tree(a){$.ajaxSetup({cache:false});var b={json_data:{ajax:{url:encodeURI(a),data:function(c){return{currentId:c!=-1?c.attr("id"):0}}}},themes:{theme:"classic",dots:true,icons:true},plugins:["themes","json_data","ui"]};if(typeof(parent._crn_obj.multiple)!="undefined"&&parent._crn_obj.multiple){b.plugins=["themes","json_data","ui","checkbox"]}$("#treeDiv").jstree(b)}function __create_ztree(a){$.ajaxSetup({cache:false});var c=_getCheck();var b={async:{enable:true,url:encodeURI(a)},check:c,data:{simpleData:{enable:true}},callback:{onClick:_ztree_single_bind_select,onCheck:___customTreeOnCheckExpandNode}};$.fn.zTree.init($("#treeDiv"),b)}function _getCheck(){var a={};if(typeof(parent._crn_obj.multiple)!="undefined"&&parent._crn_obj.multiple){a.chkboxType={Y:"ps",N:"ps"};a.enable=true;a.chkStyle="checkbox"}return a}function ___customTreeOnClickExpandNode(b,d,c){if(c){var a=$.fn.zTree.getZTreeObj(d);if(parent._crn_obj.multiple){a.checkNode(c,null,true);if(c.checked){a.expandNode(c,true,false,true,true)}}else{a.expandNode(c,true,false,true,true)}}}function ___customTreeOnCheckExpandNode(b,d,c){if(parent._crn_obj.multiple){var a=$.fn.zTree.getZTreeObj(d);if(c){if(c.checked){a.expandNode(c,true,false,true,true)}}}}function _ztree_single_bind_select(a,c,b){if(!parent._crn_obj.multiple){parent._node_id=b.id;parent._node_title=b.name;if(typeof(parent._crn_obj.onsuccess)=="undefined"||parent._crn_obj.onsuccess==""){if(typeof(parent._obj.onsuccess)!="undefined"&&parent._obj.onsuccess!=""){parent._operate="ok";parent.$.colorbox.close()}else{var d=parent._crn_obj.inputObj;if(typeof(parent._crn_obj.inputObj)=="undefined"||parent._crn_obj.inputObj==""){d=parent._obj.inputObj}parent.$("#"+d).attr("value",parent._node_title);parent.$.colorbox.close()}}else{if(parent._node_id=="_role"){alert("\u8bf7\u9009\u62e9\u89d2\u8272")}else{parent._operate="ok";parent.$.colorbox.close()}}}___customTreeOnClickExpandNode(a,c,b)}function _jstree_single_bind_select(){if(parent._obj.treeType=="jstree"){$("#treeDiv").bind("select_node.jstree",function(a){parent._node_id=$(".jstree-clicked").parent().attr("id");parent._node_title=$("#treeDiv").jstree("get_text","#"+parent._node_id);if(typeof(parent._crn_obj.onsuccess)=="undefined"||parent._crn_obj.onsuccess==""){if(typeof(parent._obj.onsuccess)!="undefined"&&parent._obj.onsuccess!=""){parent._operate="ok";parent.$.colorbox.close()}else{var b=parent._crn_obj.inputObj;if(typeof(parent._crn_obj.inputObj)=="undefined"||parent._crn_obj.inputObj==""){b=parent._obj.inputObj}parent.$("#"+b).attr("value",parent._node_title);parent.$.colorbox.close()}}else{if(parent._node_id=="_role"){alert("\u8bf7\u9009\u62e9\u89d2\u8272")}else{parent._operate="ok";parent.$.colorbox.close()}}})}}function _get_select_ztree_text(){var c=$.fn.zTree.getZTreeObj("treeDiv");var a=c.getCheckedNodes();for(var b=0;b<a.length;b++){if(!a[b].getCheckStatus().half){if(typeof(parent._node_id)=="undefined"||parent._node_id==""){parent._node_id=a[b].id;parent._node_title=a[b].name}else{parent._node_id=parent._node_id+","+a[b].id;parent._node_title=parent._node_title+","+a[b].name}}}}function _get_select_nodes_id(){var b;if(typeof(parent._crn_obj.multiple)=="undefined"||!parent._crn_obj.multiple){b=$("#treeDiv").find("li a.jstree-clicked").parent()}else{b=$("#treeDiv").find("li.jstree-checked")}var c="";for(var d=0;d<b.length;d++){c+=$(b[d]).attr("id");if(d!=b.length-1){c+=";"}}if(c!=""){var a=c.split(";");return a}else{return""}}function _get_select_text(){var a=_get_select_nodes_id();for(var b=0;b<a.length;b++){if(typeof(parent._node_id)=="undefined"||parent._node_id==""){parent._node_id=a[b];parent._node_title=$("li[id='"+a[b]+"'] a").attr("title")}else{parent._node_id=parent._node_id+","+a[b];parent._node_title=parent._node_title+","+$("li[id='"+a[b]+"'] a").attr("title")}}}function _ok(){if(parent._obj.treeType=="ztree"){_get_select_ztree_text()}else{_get_select_text()}if(typeof(parent._crn_obj.onsuccess)=="undefined"||parent._crn_obj.onsuccess==""){if(typeof(parent._obj.onsuccess)!="undefined"&&parent._obj.onsuccess!=""){parent._operate="ok";parent.$.colorbox.close()}else{var a=parent._crn_obj.inputObj;if(typeof(parent._crn_obj.inputObj)=="undefined"||parent._crn_obj.inputObj==""){a=parent._obj.inputObj}parent.$("#"+a).attr("value",parent._node_title);parent.$.colorbox.close()}}else{if(parent._node_id==""||typeof(parent._node_id)=="undefined"){alert("\u8bf7\u9009\u62e9\u8282\u70b9!")}else{parent._operate="ok";parent._onsuccess=parent._crn_obj.onsuccess;parent.$.colorbox.close()}}}function _get_url_parameter(){var b="";if(parent._crn_obj.url.indexOf("?")>=0){var d=parent._crn_obj.url.split("?");b=d[1]}var a=parent._crn_obj.postData;if(typeof(a)=="undefined"){a=parent._obj.postData}if(typeof(a)!="undefined"){for(var c in a){if(typeof(a[c])!="function"){if(b==""){b=c+"="+a[c]}else{b=b+"&"+c+"="+a[c]}}}}if(b==""){return parent._url_prn}else{return b}};
