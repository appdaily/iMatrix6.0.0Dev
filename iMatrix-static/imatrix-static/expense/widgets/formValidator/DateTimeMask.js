$.fn.DateTimeMask=function(b){var a={safemodel:true,masktype:"3",isnull:false,lawlessmessage:"\u4f60\u8f93\u5165\u7684\u683c\u5f0f\u9519\u8bef",onlycontrolkeydown:false,focuscssname:"",oldclassname:"",isnow:false,ismonthstart:false,whenfocus:function(){},whenblur:function(){return true}};b=b||{};$.extend(a,b);return this.each(function(){if(a.isnow||a.ismonthstart){this.value=$.DateTimeMask.getDateTime(a)}$(this).attr("autocomplete","off");if(a.safemodel){if($.browser.msie){this.ondragenter=function(){return false};this.onpaste=function(){return false}}}$(this).keydown(function(c){$.DateTimeMask.KeyDown(this,c,a)});if(!a.onlycontrolkeydown){$(this).focus(function(){$.DateTimeMask.SetFocus(this,a);a.whenfocus()});$(this).blur(function(){if(!$.DateTimeMask.LostFocus(this,a)){if(!a.whenblur(this.value)){this.value=this.oldvalue}}})}})};$.DateTimeMask={SetFocus:function(b,a){b.oldvalue=b.value;if(b.focuscssname&&b.focuscssname!=""){b.oldClassName=b.className;b.className=b.focuscssname}},LostFocus:function(e,c){var d,a;var b=false;switch(c.masktype){case"1":d=e.value.substr(0,10);a=e.value.substr(11);if(e.value=="0000-00-00 00:00:00"){if(!c.isnull){b=true}}else{if(!($.DateTimeMask.isValidDate(d)&&$.DateTimeMask.isValidTime(a))){b=true}}break;case"2":d=e.value.substr(0,10);a=e.value.substr(11)+":00";if(e.value=="0000-00-00 00:00"){if(!c.isnull){b=true}}else{if(!($.DateTimeMask.isValidDate(d)&&$.DateTimeMask.isValidTime(a))){b=true}}break;case"3":d=e.value;if(d=="0000-00-00"){if(!c.isnull){b=true}}else{if(!$.DateTimeMask.isValidDate(d)){b=true}}break;case"4":a=e.value+":00";if(e.value=="00:00"){if(!c.isnull){b=true}}else{if(!$.DateTimeMask.isValidTime(a)){b=true}}break;case"5":a=e.value;if(a=="00:00:00"){if(!c.isnull){b=true}}else{if(!$.DateTimeMask.isValidTime(a)){b=true}}break}if(b){if(!c.lawlessmessage||c.lawlessmessage!=""){alert(c.lawlessmessage)}e.value=e.oldvalue}if(e.focuscssname&&e.focuscssname!=""){e.className=e.oldClassName}return b},KeyDown:function(b,a,i){var c={BACKSPACE:8,TAB:9,ENTER:13,END:35,HOME:36,LEFT:37,RIGTH:39,DEL:46};var h=a.keyCode;switch(h){case c.TAB:case c.HOME:case c.END:case c.LEFT:case c.RIGTH:return;case c.ENTER:a.preventDefault();if(i.EnterMoveToNext){a.keyCode=9}return}if(b.ReadOnly){a.returnValue=false;return}var d=b.value;var f=d.length;var g=$.DateTimeMask.GetCursor(b).start;a.returnValue=false;a.preventDefault();switch(h){case c.BACKSPACE:if(g>0){fronttext=d.substr(g-1,1);if(fronttext!="-"&&fronttext!=":"&&fronttext!=" "){fronttext="0";d=d.substr(0,g-1)+fronttext+d.substr(g,f-g)}g--}break;case c.DEL:if(g<f){behindtext=d.substr(g,1);if(behindtext!="-"&&behindtext!=":"&&behindtext!=" "){behindtext="0"}if(g+1==f){d=d.substr(0,g)+behindtext}else{d=d.substr(0,g)+behindtext+d.substr(g+1,f-g-1)}g++}break;default:if(g==f){break}if(!(h>=48&&h<=57||h>=96&&h<=105)){break}if(h>95){h-=(95-47)}behindtext=d.substr(g,1);if(behindtext!="-"&&behindtext!=":"&&behindtext!=" "){var e=String.fromCharCode(h);preText=d.substr(0,g)+e+d.substr(g+1,f);if(!$.DateTimeMask.DealWith(i.masktype,preText,g)){break}d=preText;g++}if(g>d.length){g=d.length}if(i.masktype<="3"){if(g==4||g==7||g==10||g==13||g==16){g++}}else{if(g==2||g==5){g++}}break}b.value=d;$.DateTimeMask.Selection(b,g,g)},DealWith:function(e,c,b){var d,a;if(e<="3"){ls_year=c.substr(0,4);if(ls_year=="0000"){ls_year="2001"}ls_month=c.substr(5,2);if(ls_month=="00"){ls_month="01"}ls_day=c.substr(8,2);if(ls_day=="00"){ls_day="01"}d=ls_year+"-"+ls_month+"-"+ls_day;a="00:00:00";if(e=="1"){a=c.substr(11)}else{if(e=="2"){a=c.substr(11)+":00"}}return(b<=10?$.DateTimeMask.isValidDate(d):$.DateTimeMask.isValidTime(a))}else{a=c;if(e=="4"){a=a+":00"}return $.DateTimeMask.isValidTime(a)}return true},GetCursor:function(g){var e=new Object();var h=0,a=0;if($.browser.mozilla){h=g.selectionStart;a=g.selectionEnd}if($.browser.msie){var c=g.createTextRange();var f=c.text;var d=document.selection.createRange();var b=d.text;while(d.compareEndPoints("StartToStart",c)>0){d.moveStart("character",-1);h++}while(d.compareEndPoints("EndToStart",c)>0){d.moveEnd("character",-1);a++}}e.start=h;e.end=a;return e},Selection:function(c,d,a){if(c.createTextRange){var b=c.createTextRange();b.moveStart("character",d);b.collapse(true);b.select()}else{if(c.setSelectionRange){c.setSelectionRange(d,a)}else{if(c.selectionStart){c.selectionStart=d;c.selectionEnd=a}}}c.focus()},isValidDate:function(a){var c="^((((((0[48])|([13579][26])|([2468][048]))00)|([0-9][0-9]((0[48])|([13579][26])|([2468][048]))))-02-29)|(((000[1-9])|(00[1-9][0-9])|(0[1-9][0-9][0-9])|([1-9][0-9][0-9][0-9]))-((((0[13578])|(1[02]))-31)|(((0[1,3-9])|(1[0-2]))-(29|30))|(((0[1-9])|(1[0-2]))-((0[1-9])|(1[0-9])|(2[0-8]))))))$";var b=new RegExp(c,"i");return b.test(a)},isValidTime:function(c){var b=c.match(/^(\d{2,2})(:)?(\d{2,2})\2(\d{2,2})$/);if(!b||b[1]>23||b[3]>59||b[4]>59){return false}return true},getDateTime:function(k){var c=new Date();var f=c.getFullYear();var b=c.getMonth()+1;b=(b<10?"0"+b:b);var j=c.getDate();var i=f+"-"+b+"-"+(j<10?"0"+j:j);var a=c.getHours();var e=c.getMinutes();var g=c.getSeconds();var h=(a<10?"0"+a:a)+":"+(e<10?"0"+e:e)+":"+(g<10?"0"+g:g);switch(k.masktype){case"1":return k.isnow?(i+" "+h):(f+"-"+b+"-01 00:00:00");case"2":return k.isnow?(i+" "+h.substr(0,5)):(f+"-"+b+"-01 00:00");case"3":return k.isnow?i:(f+"-"+b+"-01");case"4":return h.substr(0,5);case"5":return h}}};
