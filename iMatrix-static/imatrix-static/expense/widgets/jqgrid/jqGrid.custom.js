var lastsel;var newId;var hasEdit=false;var deleteUrl="";var editing=false;var delRowWarning="\u8bf7\u9009\u62e9\uff01";function initStandardListControl(a){$("input[pluginType=STANDARD_LIST_CONTROL]").css("display","none")}function isHasEdit(a){if(typeof(a)!="undefined"){saveRowWhenAdd(lastsel,a);return hasEdit}var b=$("input[pluginType='STANDARD_LIST_CONTROL']");for(var c=0;c<b.length;c++){var d="tb_"+$(b[c]).attr("id");saveRowWhenAdd(lastsel,d);if(hasEdit){return hasEdit}}return hasEdit}function getSubTableDatas(a){alert("\u65b9\u6cd5\u8c03\u7528\u4fee\u6539\uff1a\u8bf7\u628a\u3010getSubTableDatas(formId);\u3011\u66f4\u6362\u4e3a\u3010iMatrix.getSubTableDatas(formId);\u3011")}function getFormGridDatas(b,a){alert("\u65b9\u6cd5\u8c03\u7528\u4fee\u6539\uff1a\u8bf7\u628a\u3010getFormGridDatas(formId,tableId);\u3011\u66f4\u6362\u4e3a\u3010iMatrix.getFormGridDatas(formId,tableId);\u3011")}function getOneGridDatas(m,c,n){var d="";var h=$("#"+c).jqGrid("getGridParam","indexname");d=n+":"+h+"=";var g=$("#"+c).jqGrid("getRowData");var k=$("#"+c).jqGrid("getGridParam","colModel");var i="";if(g.length>0){i="["}for(var e=0;e<g.length;e++){var f=g[e];delete f.act;var b="";for(var a in f){if(b==""){b="{"}if(typeof(f[a])!="function"){if(a=="id"&&f[a].indexOf("new_")>=0){b=b+'"'+a+'":{"value":""},'}else{var q=getkeyByValue(a,f[a],k);if(a=="id"){b=b+'"'+a+'":{"value":"'+q[1]+'"},'}else{if(a.indexOf("_")>=0){var o=/_/g;a=a.replace(o,".")}var l=q[1];l=l.replace(new RegExp('"',"gm"),"_@_#");b=b+'"'+a+'":{"value":"'+l+'","datatype":"'+q[0]+'","classname":"'+q[2]+'"},'}}}}if(b.indexOf(",")>=0){b=b.substring(0,b.length-1)}if(b!=""){b=b+"}"}i=i+b+","}if(i.indexOf(",")>=0){i=i.substring(0,i.length-1)}if(g.length>0){i=i+"]"}d=d+i;return d}function restoreOtherTable(c){var a=$("input[pluginType='STANDARD_LIST_CONTROL']");for(var b=0;b<a.length;b++){var d="tb_"+$(a[b]).attr("id");if(d!=c){jQuery("#"+d).jqGrid("restoreRow",lastsel,function(){hasEdit=false;if(lastsel.indexOf("new_")>=0){jQuery("#"+d).jqGrid("delRowData",lastsel);_add_row(d)}})}}}function getkeyByValue(h,f,b){var a=new Array();for(var c=0;c<b.length;c++){if(h==b[c].name){a[0]=b[c].mydatatype;var e=b[c].classname;if(typeof(e)!="undefined"){a[2]=e}else{a[2]=""}var d=b[c].valueset;if(typeof(d)!="undefined"){for(var g in d){if(typeof(d[g])!="function"){if(d[g]==f){a[1]=g;return a}}}}}}a[1]=f;return a}function deleteFormTableData(e,d,f,b,c){if(hasEdit){alert("\u8bf7\u6309ESC\u6216ENTER\u952e\u53d6\u6d88\u7f16\u8f91\u72b6\u6001");_add_row(e);return}if(confirm("\u786e\u8ba4\u5220\u9664\u5417?")){if(d.indexOf("new_")<0){var a=f;if(a.indexOf("?")<0){a=a+"?id="+d+"&callback=?"}else{a=a+d+"&callback=?"}if(f==""){alert("\u8bf7\u5728\u7cfb\u7edf\u6784\u5efa\u5e73\u53f0\u4e2d\u914d\u5220\u9664\u6570\u636e\u7684url")}else{if(typeof(b)!="undefined"&&b){a=c+a}$.getJSON(a,function(g){jQuery("#"+e).jqGrid("delRowData",d);hasEdit=false;_add_row(e);alert(g.msg)})}}else{deleteRowData(e,d);_add_row(e)}}}function deleteRowData(b,a){jQuery("#"+b).jqGrid("delRowData",a);hasEdit=false}function $deleteFormTableData(d,c,a,b){}function tableColumnChange(a){$("#"+a.rowid+"_headerName").attr("value",$("#"+a.currentInputId).find("option:selected").text())}function saveRowWhenAdd(b,a){return jQuery("#"+a).jqGrid("saveRow",b,function(){},"",{},function(){hasEdit=false;$editRowSave(b,a);b=0},function(){},function(){hasEdit=false;$editRowRestore(b,a);b=0})}function getLastNewId(a){var c=jQuery("#"+a).attr("newId");if(typeof(c)=="undefined"||c==""){jQuery("#"+a).attr("newId",1);return 1}else{var b=parseInt(c);jQuery("#"+a).attr("newId",b+1);return b+1}}function changeAct(c,b,d){newId=getLastNewId(c);var a=jQuery("#"+c).jqGrid("getDataIDs");for(var e=0;e<a.length;e++){var k=a[e];var h="<a href='#pos' class='small-button-bg' onclick=\"myAddRow(newId,'"+k+"','"+c+"','"+b+"','"+d+"');\"><span class='ui-icon ui-icon-plusthick'></span></a>";var g="";if(deleteUrl!=""){g="<a href='#pos' class='small-button-bg' onclick=\"deleteFormTableData('"+c+"','"+k+"','"+deleteUrl+"','"+b+"','"+d+"');\" ><span class='ui-icon  ui-icon-minusthick'></span></a>"}else{g="<a href='#pos' class='small-button-bg' onclick=\"$deleteFormTableData('"+c+"','"+k+"');\" ><span class='ui-icon  ui-icon-minusthick'></span></a>"}var f="<a href='#pos' class='small-button-bg' onclick=\"editClick('"+k+"');\" ><span class='ui-icon  ui-icon-pencil'></span></a>";if(a.length>1){jQuery("#"+c).jqGrid("setRowData",a[e],{act:h+" "+g+" "+f+_getCustomeButtons(c,a[e])})}else{jQuery("#"+c).jqGrid("setRowData",a[e],{act:h})}}}function _add_row(d){var b=jQuery("#"+d).jqGrid("getDataIDs");if(b.length==0){var a="<a href='#pos' class='small-button-bg' onclick=\"myAddRow('1','new_0','"+d+"');\"><span class='ui-icon ui-icon-plusthick'></span></a>";var e="";if(deleteUrl!=""){e="<a href='#pos' class='small-button-bg' onclick=\"deleteFormTableData('"+d+"','new_0','"+deleteUrl+"');\" ><span class='ui-icon  ui-icon-minusthick'></span></a>"}else{e="<a href='#pos' class='small-button-bg' onclick=\"$deleteFormTableData('"+d+"','new_0');\" ><span class='ui-icon  ui-icon-minusthick'></span></a>"}var c="<a href='#pos' class='small-button-bg' onclick=\"editClick('new_0');\" ><span class='ui-icon  ui-icon-pencil'></span></a>";jQuery("#"+d).jqGrid("addRowData","new_0",{act:a+" "+e+" "+c+_getCustomeButtons(d,"new_0")});customGridEditRow("new_0",d)}}function myAddRow(b,a,d,f,e){var c=getLastNewId(d);if(b!=c){b=c}saveRowWhenAdd(lastsel,d);if(!hasEdit){jQuery("#"+d).jqGrid("addRowData","new_"+b,{},"after",a);customGridEditRow("new_"+b,d);changeAct(d,f,e);$addRowCallBack("new_"+b,a,d)}}function customGridEditRow(b,a){jQuery("#"+a).jqGrid("editRow",b,true,editFun,function(){},"",{},function(){hasEdit=false;$editRowSave(b,a);lastsel=0},function(){},function(){hasEdit=false;$editRowRestore(b,a);lastsel=0;if(b.indexOf("new_")>=0){jQuery("#"+a).jqGrid("delRowData",b);_add_row(a)}})}function formatFun(a,b,c){return getShowValue(a,b)}function getShowValue(c,a){var b=a.colModel.valueset;if(typeof(b)!="undefined"){for(var d in b){if(d==c&&typeof(b[d])!="function"){if(b[d]==""){return"&nbsp;"}else{return b[d]}}}}if(typeof(c)=="undefined"||c==""){return"&nbsp;"}else{return c}}function formatCheckbox(c,f,e,d,b){var a="";if(c=="true"||c=="1"){a='<input type="checkbox" disabled="disabled" checked="checked" value="true"/>'}else{a='<input type="checkbox" disabled="disabled" value="false"/>'}return a}function unFormatCheckbox(b,c,a){return $("input",a).attr("value")}function unFormatCurrentDate(b,c,a){if($(a).html()=="&nbsp;"){return formate_date(new Date())}return $(a).html()}function unFormatCurrentTime(b,c,a){if($(a).html()=="&nbsp;"){return formate_date_second(new Date())}return $(a).html()}function unFormatUserName(b,c,a){if($(a).html()=="&nbsp;"){return $("#_user_name").val()}return $(a).html()}function unFormatLoginName(b,c,a){if($(a).html()=="&nbsp;"){return $("#_login_name").val()}return $(a).html()}function formate_date_second(c){var d=c.getMinutes();var a=c.getHours();var b=c.getSeconds();if(b<10){b="0"+b}if(d<10){d="0"+d}if(a<10){a="0"+a}return c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+a+":"+d+":"+b}function formate_date(c){var d=c.getMinutes();var a=c.getHours();var b=c.getSeconds();if(b<10){b="0"+b}if(d<10){d="0"+d}if(a<10){a="0"+a}return c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()}function $processRowData(a){return a}function $getExtraParams(){return{}}function $onCellClick(b,a,c,d){}var editableGridOptions={gridId:"",deleteUrl:"",rowSortable:true,sortUrl:"",havePage:true,extraParams:{}};var editableGrid;var rowId,originalIndex,newIndex;var sortableOptions={items:".jqgrow:not(.unsortable)",start:function(a,b){rowId=b.item.attr("id");originalIndex=editableGrid.jqGrid("getInd",rowId)},stop:function(a,b){newIndex=editableGrid.jqGrid("getInd",rowId);var c={};c=$.extend(true,c,editableGridOptions.extraParams,{originalIndex:originalIndex,newIndex:newIndex});$.post(editableGridOptions.sortUrl,c)}};function makeEditable(a){if(a){editing=false;if(editableGridOptions.rowSortable){jQuery("#"+editableGridOptions.gridId+" tbody").sortable("enable")}lastsel=null}else{editing=true;if(editableGridOptions.rowSortable){jQuery("#"+editableGridOptions.gridId+" tbody").sortable("disable")}}}function editNextRow(c){var b=editableGrid.jqGrid("getDataIDs");var a=editableGrid.jqGrid("getInd",c);a++;if(a>b.length){editableGrid.resetSelection();iMatrix.addRow(true)}else{editableGrid.resetSelection();editRow(b[a-1]);editableGrid.setSelection(b[a-1],true)}}function afterSaveRow(rowId,data){var jsonData=eval("("+data.responseText+")");if(rowId==0){editableGrid.jqGrid("delRowData",rowId);editableGrid.jqGrid("addRowData",jsonData.id,jsonData,"last")}else{editableGrid.jqGrid("setRowData",jsonData.id,jsonData)}editNextRow(jsonData.id)}var editParams={keys:true,oneditfunc:function(a){editFun(a);$oneditfunc(a)},successfunc:function(a){return $successfunc(a)},aftersavefunc:function(b,a){afterSaveRow(b,a);$aftersavefunc(b,a)},afterrestorefunc:function(a){makeEditable(true);$afterrestorefunc(a)},restoreAfterError:false,extraparam:editableGridOptions.extraParams};function $successfunc(a){return true}function $oneditfunc(a){}function $aftersavefunc(b,a){}function $afterrestorefunc(a){}function $ondblClickRow(c,d,a,b){}function $addGridOption(a){}function $gridComplete(){}function $loadBeforeSend(b,a){}function $beforeEditRow(c,d,a,b){return true}function addRow(a){alert("\u65b9\u6cd5\u8c03\u7528\u4fee\u6539\uff1a\u8bf7\u628a\u3010addRow();\u3011\u66f4\u6362\u4e3a\u3010iMatrix.addRow();\u3011")}function editRow(c,d,a,b){if("null"!=c){if(!$beforeEditRow(c,d,a,b)){return}if(c==lastsel){return}else{editableGrid.jqGrid("restoreRow",lastsel)}lastsel=c;editableGrid.jqGrid("editRow",c,editParams);focusOnClickedCell(c,b);makeEditable(false);$ondblClickRow(c,d,a,b)}}function focusOnClickedCell(c,b){var a=editableGrid[0].p;if((a.multiselect&&$.inArray(c,a.selarrrow)<0)||c!=a.selrow){editableGrid.jqGrid("setSelection",c,true)}}function delRow(){alert("\u65b9\u6cd5\u8c03\u7528\u4fee\u6539\uff1a\u8bf7\u628a\u3010delRow();\u3011\u66f4\u6362\u4e3a\u3010iMatrix.delRow();\u3011")}function initJqGrid(a){var b=$getExtraParams();a.extraParams=$.extend(true,a.extraParams,b);editableGridOptions=$.extend(true,editableGridOptions,a);editableGrid=$("#"+editableGridOptions.gridId);jqGridOption.postData=$.extend(true,jqGridOption.postData,b);$addGridOption(jqGridOption);if(editableGridOptions.havePage){editableGrid.jqGrid(jqGridOption).navGrid("#"+editableGridOptions.gridId+"_pager",{edit:false,add:false,del:false,search:false})}else{editableGrid.jqGrid(jqGridOption)}if(editableGridOptions.sortUrl!=""){editableGrid.jqGrid("sortableRows",sortableOptions)}}function export_Data(a){alert("\u65b9\u6cd5\u8c03\u7528\u4fee\u6539\uff1a\u8bf7\u628a\u3010export_Data(url);\u3011\u66f4\u6362\u4e3a\u3010iMatrix.export_Data(url);\u3011")}function submit_export(f,c,b,d){var a=$("form[name='"+f+"']");var e={_list_code:$(c).attr("_list_code")};if(""!=d&&$("#_dynamic_export_data").length<1){e={_list_code:$(c).attr("_list_code"),_dynamic_column_name:d}}if($("#___searchParameters").attr("id")=="___searchParameters"){e=$.extend(true,e,{searchParameters:$("#___searchParameters").attr("value")})}$.ajax({data:e,type:"post",url:encodeURI(b),beforeSend:function(g){},success:function(i,n){if(i!=""){var l=i.lastIndexOf("_");var k=i.substring(0,l);var g=webRoot;if(typeof(appRoot)!="undefined"&&appRoot!=""){g=appRoot}var m=g+"/portal/export-data.action?fileName="+i;var h='<div style="margin-top: 30px;text-align: center"><a style="text-decoration: underline;" onclick="parent.$.colorbox.close();" href="'+encodeURI(m)+'">\u8bf7\u70b9\u51fb\u6587\u4ef6\u540d\u4e0b\u8f7d\u6587\u4ef6 : '+k+"</a></div>";afterExportData();$.colorbox({href:h,inline:true,innerWidth:280,innerHeight:100,overlayClose:false,title:"\u6587\u4ef6\u4e0b\u8f7d"})}},complete:function(g,h){},error:function(){}})}function afterExportData(){$("#_loading_div_id").hide();$afterExportData()}function $afterExportData(){}function validatePageInput(){$(".ui-pg-input").bind("keyup",function(){var b=$(".ui-pg-input").attr("value");b=b.replace(/[^\d]/g,"");$(".ui-pg-input").attr("value",b);if($(".ui-pg-input").attr("value")!=""){var a=$("#sp_1_"+editableGridOptions.gridId+"_pager").html();if(parseInt(a.replace(/\s/g,""))<parseInt($(".ui-pg-input").attr("value"))){$(".ui-pg-input").attr("value","")}}})}function totalPageSetting(){if($("#___searchParameters").attr("id")=="___searchParameters"&&$("#___searchParameters").attr("value")!=""){if($("#searchTotalable_page_id").val()=="true"){showTotalPage()}else{hideTotalPage()}}else{if($("#totalable_page_id").val()=="true"){showTotalPage()}else{hideTotalPage()}}}function hideTotalPage(){$.each($($("#"+editableGridOptions.gridId+"_pager_center")).find("td"),function(a){if(!(a==1||a==5)){$(this).hide()}});$.each($($("#"+editableGridOptions.gridId+"_pager_right")).children(),function(a){$(this).hide()})}function showTotalPage(){$.each($($("#"+editableGridOptions.gridId+"_pager_center")).find("td"),function(a){if(!(a==1||a==5)){$(this).show()}});$.each($($("#"+editableGridOptions.gridId+"_pager_right")).children(),function(a){$(this).show()})}function savePageInfo(){var g=editableGrid.jqGrid("getGridParam","prmNames");var d=editableGrid.jqGrid("getGridParam","postData");var c=g.rows;var e=g.page;var f=g.sort;var b=g.order;if($("#___pageSizeName").attr("id")=="___pageSizeName"){if("true"==$("#___signPageInfo").attr("value")){$("#___pageSizeName").attr("value",$("#___pageSizeName").attr("value"));$("#___pageNoName").attr("value",$(".ui-pg-input").val());$("#___orderByName").attr("value",$("#___orderByName").attr("value"));$("#___orderName").attr("value",$("#___orderName").attr("value"))}else{$("#___pageSizeName").attr("value",d[c]);$("#___pageNoName").attr("value",d[e]);$("#___orderByName").attr("value",d[f]);$("#___orderName").attr("value",d[b])}$("#___signPageInfo").attr("value",false)}else{var a=$("body");$(a).append("<input type='hidden' id='___pageSizeName' value='"+d[c]+"'/><input type='hidden' id='___pageNoName' value='"+d[e]+"'/><input type='hidden' id='___orderByName' value='"+d[f]+"'/><input type='hidden' id='___orderName' value='"+d[b]+"'/><input type='hidden' id='___signPageInfo' value='false'/>")}}function setPageState(){$("#___signPageInfo").attr("value",true)}function updateGridPageInfo(l,c){if("true"==$("#___signPageInfo").attr("value")){var f=editableGrid.jqGrid("getGridParam","prmNames");var k=f.rows;var m=f.page;var h=f.sort;var b=f.order;var n={};n[k]=$("#___pageSizeName").attr("value");n[m]=$("#___pageNoName").attr("value");n[h]=$("#___orderByName").attr("value");n[b]=$("#___orderName").attr("value");var g=c.data.split("&");var e;var a="";for(var d=0;d<g.length;d++){if(d!=0){a+="&"}e=g[d].split("=");if(e[0]==k){a=(a+k+"="+$("#___pageSizeName").attr("value"))}else{if(e[0]==m){a=(a+m+"="+$("#___pageNoName").attr("value"))}else{if(e[0]==k){a=(a+k+"="+$("#___orderByName").attr("value"))}else{if(e[0]==b){a=(a+b+"="+$("#___orderName").attr("value"))}else{a+=g[d]}}}}}c.data=a}}function defaultSelectFirstRow(){if($("#"+editableGridOptions.gridId).getDataIDs().length>0){$("#"+editableGridOptions.gridId).jqGrid("setSelection",$("#"+editableGridOptions.gridId).getDataIDs()[0])}}function $ondblClick(a){}function $onRightClick(a){}function _getCustomeButtons(tableId,rowid){var obj=$addButton();if(obj==""){return""}else{var btn="";var btns=eval("("+obj+")");for(var i=0;i<btns.length;i++){btn+=" <a href='#pos' name='"+btns[i].name+"' class='small-button-bg' onclick=\""+btns[i].click+"('"+rowid+"','"+tableId+"');\"><span class='"+btns[i].className+"'></span></a>"}return btn}}function $addButton(){return""}function merger(e,a,k){var d=$("#"+e+"").getDataIDs();var b=d.length;for(var f=0;f<b;f++){var g=$("#"+e+"").jqGrid("getRowData",d[f]);var h=1;for(j=f+1;j<=b;j++){var c=$("#"+e+"").jqGrid("getRowData",d[j]);if((k!=""&&g[a]==c[a]&&g[k]==c[k])||(k==""&&g[a]==c[a])){h++;$("#"+e+"").setCell(d[j],a,"",{display:"none"})}else{h=1;break}jQuery("td[id="+a+d[f]+"]","#"+e).attr("rowspan",h)}}}function querySettingName(b){var a=webRoot;if(typeof(appRoot)!="undefined"&&appRoot!=""){a=appRoot}if(typeof(b.currentInputId)=="undefined"||b.currentInputId==""){alert("\u8bf7\u5f55\u5165currentInputId\u7684\u503c\uff01");return}$.colorbox({href:a+"/portal/querySetting.action?currentInputId="+b.currentInputId,iframe:true,innerWidth:400,innerHeight:248,overlayClose:false,title:"\u67e5\u8be2\u8bbe\u7f6e"})}function querySettingNameClick(a){querySettingName({currentInputId:a.currentInputId})}function formatPercent(a,c,f){var e=c.colModel.iMatrix_formatter;var d=0;if(a.indexOf(".")!=-1){d=e.length-3}var b=a-0;b*=100;b=b.toFixed(d);return b+"%"}function unFormatPercent(b,d,a){var f=b;f=f.substring(0,f.length-1);var c=f-0;var e=c/100;return e}function $dateOnSelect(a){}function $dateOnChangeMonthYear(a){}function $dateOnClose(a){}function $sortableRowsStart(c,b,a){}function $sortableRowsStop(c,a,b){}function $addRowCallBack(c,a,b){}function $editRowSave(b,a){}function $editRowRestore(b,a){}function $editClickCallback(b,a){}function controlName(b){var a=webRoot;if(typeof(appRoot)!="undefined"&&appRoot!=""){a=appRoot}if(typeof(b.currentInputId)=="undefined"||b.currentInputId==""){alert("\u8bf7\u5f55\u5165currentInputId\u7684\u503c\uff01");return}$.colorbox({href:a+"/portal/controlType.action?currentInputId="+b.currentInputId,iframe:true,innerWidth:400,innerHeight:248,overlayClose:false,title:"\u9009\u62e9\u63a7\u4ef6\u7c7b\u578b"})}function controlNameClick(a){var b=a.currentInputId;controlName({currentInputId:b})}function formGridTree(d){var e=webRoot;if(typeof(appRoot)!="undefined"&&appRoot!=""){e=appRoot}var c="";var b="";if(d.isMutiply){c="checkbox";if(d.treeType=="DEPARTMENT_TREE"){b="{'Y' : 's', 'N' : 's' }"}else{b="{'Y' : 'ps', 'N' : 'ps' }"}}var a={leaf:{enable:false},type:{treeType:d.treeType,noDeparmentUser:true,onlineVisible:false},data:{chkStyle:c,chkboxType:b},view:{title:"\u4eba\u5458\u90e8\u95e8\u6811",width:300,height:400,url:e,showBranch:false},feedback:{enable:true,showInput:d.currentInputId,hiddenInput:d.currentInputId,append:false},callback:{onClose:function(){if(d.useType){formGridTreeCallBack(d.rowid,d.hiddenField,d.treeType,d.isMutiply)}}}};popZtree(a)}function formGridTreeCallBack(d,a,c,b){if(a!=""&&(c=="COMPANY"||c=="MAN_DEPARTMENT_GROUP_TREE"||c=="MAN_DEPARTMENT_TREE"||c=="MAN_GROUP_TREE")){if(b){$("#"+d+"_"+a).attr("value",ztree.getLoginNames())}else{$("#"+d+"_"+a).attr("value",ztree.getLoginName())}}else{if(b){$("#"+d+"_"+a).attr("value",ztree.getIds())}else{$("#"+d+"_"+a).attr("value",ztree.getId())}}};
