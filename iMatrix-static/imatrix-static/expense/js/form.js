function decimal(b,a){var c=Math.pow(10,a);return Math.round(b*c)/c}function MAX(){if(arguments.length==0){return}var a=arguments[0];for(var b=0;b<arguments.length;b++){a=Math.max(a,arguments[b])}return parseFloat(a)}function MIN(){if(arguments.length==0){return}var a=arguments[0];for(var b=0;b<arguments.length;b++){a=Math.min(a,arguments[b])}return parseFloat(a)}function ABS(a){if(a==""){a=0}return Math.abs(parseFloat(a))}function AVG(){if(arguments.length==0){return}var b=0;for(var a=0;a<arguments.length;a++){b+=parseFloat(arguments[a])}return parseFloat(b/arguments.length)}function RMB(a){if(a==""||isNaN(a)){a=0}return convertCurrency(parseFloat(a))}function convertCurrency(g){var c=99999999999.99;var e="\u96f6";var B="\u58f9";var o="\u8d30";var v="\u53c1";var w="\u8086";var H="\u4f0d";var E="\u9646";var s="\u67d2";var K="\u634c";var q="\u7396";var h="\u62fe";var D="\u4f70";var y="\u4edf";var J="\u4e07";var n="\u4ebf";var l="\u5143";var G="\u89d2";var k="\u5206";var m="\u6574";var b;var j;var x;var C;var u,a,A,L;var t;var F,z,I;var f,r;g=g.toString();if(g==""){alert("Empty input!");return""}if(g.match(/[^,.\d]/)!=null){alert("Invalid characters in the input string!");return""}if((g).match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/)==null){alert("Illegal format of digit number!");return""}g=g.replace(/,/g,"");g=g.replace(/^0+/,"");if(Number(g)>c){alert("\u8d85\u51fa\u6570\u503c\u8303\u56f4!");return""}C=g.split(".");if(C.length>1){b=C[0];j=C[1];j=j.substr(0,2)}else{b=C[0];j=""}u=new Array(e,B,o,v,w,H,E,s,K,q);a=new Array("",h,D,y);A=new Array("",J,n);L=new Array(G,k);x="";if(Number(b)>0){t=0;for(F=0;F<b.length;F++){z=b.length-F-1;I=b.substr(F,1);f=z/4;r=z%4;if(I=="0"){t++}else{if(t>0){x+=u[0]}t=0;x+=u[Number(I)]+a[r]}if(r==0&&t<4){x+=A[f]}}x+=l}if(j!=""){for(F=0;F<j.length;F++){I=j.substr(F,1);if(I!="0"){x+=u[Number(I)]+L[F]}}}if(x==""){x=e+l}if(j==""){x+=m}x=x;return x}function DAY(){if(arguments.length<2){alert("\u8bf7\u586b\u5199\u65e5\u671f");return""}if((isValidDate(arguments[0])||isValidTime(arguments[0]))&&(isValidDate(arguments[1])||isValidTime(arguments[1]))){var c=stringToDate(arguments[0]);var b=stringToDate(arguments[1]);var d=c.getTime()-b.getTime();var a=Math.pow(10,1);return Math.round(d/(1000*60*60*24)*a)/a}else{alert("\u65e5\u671f\u683c\u5f0f\u65e0\u6548");return""}}function HOUR(){if(arguments.length<2){alert("\u8bf7\u586b\u5199\u65e5\u671f");return""}if((isValidDate(arguments[0])||isValidTime(arguments[0]))&&(isValidDate(arguments[1])||isValidTime(arguments[1]))){var c=stringToDate(arguments[0]);var b=stringToDate(arguments[1]);var d=c.getTime()-b.getTime();var a=Math.pow(10,1);return Math.round(d/(1000*60*60)*a)/a}else{alert("\u65e5\u671f\u683c\u5f0f\u65e0\u6548");return""}}function DATE(){if(arguments.length<2){alert("\u8bf7\u586b\u5199\u65e5\u671f");return""}if((isValidDate(arguments[0])||isValidTime(arguments[0]))&&(isValidDate(arguments[1])||isValidTime(arguments[1]))){var d=stringToDate(arguments[0]);var c=stringToDate(arguments[1]);var e=d.getTime()-c.getTime();if(e<0){alert("\u65e5\u671f\u683c\u5f0f\u65e0\u6548");return""}else{var f=Math.floor(e/(1000*60*60*24));e-=f*(1000*60*60*24);var a=Math.floor(e/(1000*60*60));e-=a*(1000*60*60);var b=Math.floor(e/(1000*60));return f+"\u5929"+a+"\u5c0f\u65f6"+b+"\u5206"}}else{alert("\u65e5\u671f\u683c\u5f0f\u65e0\u6548");return""}}function isValidDate(a){var c=/(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)/;var b=a.match(c);if(b==null){return false}return true}function isValidTime(c){var a="^((([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29))\\s+([0-1]?[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$";var b=c.match(a);if(b==null){return false}return true}function stringToDate(strDate){var date=eval("new Date("+strDate.replace(/\d+(?=-[^-]+$)/,function(a){return parseInt(a,10)-1}).match(/\d+/g)+")");return date}function init_parseComputational(){var c=$("input[pluginType=CALCULATE_COMPONENT]");var a=$("input[pluginType=TEXT]");for(var b=0;b<c.length;b++){$(c[b]).attr("value","")}}function parseComputational(computational,id){try{var inputsText=$("input[pluginType=TEXT]");var inputsDate=$("input[pluginType=TIME]");var num=inputsText.length+inputsDate.length;var inputs=new Array(num);var j=0;for(var i=0;i<inputsText.length;i++){inputs[j]=inputsText[i];j++}for(var i=0;i<inputsDate.length;i++){inputs[j]=inputsDate[i];j++}for(var i=0;i<inputs.length;i++){var re=new RegExp("([(+*/^,-]*)"+$(inputs[i]).attr("id")+"([)+*/^,-]*)","g");var initCom=computational;computational=computational.replace(re,"$1parseFloat($('#"+$(inputs[i]).attr("id")+"').attr('value'))$2")}var floatingReg=new RegExp("^([+-]?)\\d*\\.\\d+$");var integerReg=new RegExp("^-?[1-9]\\d*$");var result=eval(computational);if(floatingReg.test(result)||integerReg.test(result)){$("#"+id).attr("value",decimal(result,parseInt($("#"+id).attr("prec"))));if(isNaN($("#"+id).attr("value"))){$("#"+id).attr("value","")}}else{$("#"+id).attr("value",result)}}catch(e){alert("\u60a8\u7684\u8ba1\u7b97\u516c\u5f0f\u4e0d\u5408\u6cd5\uff0c\u8bf7\u53c2\u8003\u63a7\u4ef6\u7684\u5c5e\u6027\u8bf4\u660e\u4fee\u6539\uff01\u9519\u8bef\u4fe1\u606f\uff1a["+e.message+"]")}}function parse(){}function selectChange(parentValue,child,cur_val){var childArray=child.split(",");for(var i=0;i<childArray.length;i++){if(childArray[i]!=""){$("#"+childArray[i]).find("option").remove();var objOption=document.createElement("OPTION");objOption.text="\u8bf7\u9009\u62e9";objOption.value="";if(document.getElementById(childArray[i])!=null){document.getElementById(childArray[i]).options.add(objOption)}var arr=eval("arr_"+childArray[i]);var optionStr=arr[childArray[i]][parentValue];if(optionStr){var optionArr=optionStr.split(",");for(var j=0;j<optionArr.length;j++){if(optionArr[j]!=""){objOption=document.createElement("OPTION");var valArr=optionArr[j].split(":");var val="";if(valArr.length==1){objOption.text=valArr[0];objOption.value=valArr[0];val=valArr[0]}else{if(valArr.length>1){objOption.text=valArr[1];objOption.value=valArr[0];val=valArr[0]}}document.getElementById(childArray[i]).options.add(objOption);if(typeof cur_val!="undefined"&&cur_val==val){$("#"+childArray[i]).attr("value",cur_val)}}}}if(parentValue==""){$("#"+childArray[i]).val("")}}}}function initSelect(selstr,parentObj){var selArray=selstr.split(",");for(var i=0;i<selArray.length;i++){if(selArray[i]!=""){var arr=eval("arr_"+selArray[i]);arr[selArray[i]]=new Array();var cur_val;var temp="#"+selArray[i];var options=$(temp).children();for(var j=0;j<options.length;j++){var str=$(options[j]).attr("myvalue");var strtext=$(options[j]).attr("text");if(typeof str!="undefined"&&str.indexOf("|")>=0){$(options[j]).attr("value",str.substring(0,str.indexOf("|")));var father=str.substring(str.indexOf("|")+1,str.length);var optionValue=str.substring(0,str.indexOf("|"));if($("#"+selArray[i]).get(0).selectedIndex==j){cur_val=optionValue}if(typeof arr[selArray[i]][father]=="undefined"){arr[selArray[i]][father]=""}arr[selArray[i]][father]+=optionValue+":"+strtext+","}else{$(options[j]).attr("value",str)}}selectChange($("#"+parentObj).attr("value"),selArray[i],cur_val)}}}function ajaxGetData(referenceControlId,code,version,dataControl,dataField,controlId){var root=webRoot;if(typeof(appRoot)!="undefined"&&appRoot!=""){root=appRoot}if(controlsExistFun(referenceControlId)&&controlsExistFun(dataControl)){$.ajax({type:"POST",dataType:"text",url:root+"/portal/get-data.action",data:"referenceControlValue="+$("#"+referenceControlId).attr("value")+"&code="+code+"&version="+version+"&formControlId="+controlId,success:function(text,textStatus){if(text!=""){var json=eval("("+text+")");$.each(json,function(key,value){var arr=dataField.split(",");var dcArr=dataControl.split(",");for(var i=0;i<arr.length;i++){if(arr[i]!=""){if(arr[i].indexOf("dt_")==0&&arr[i].toLowerCase()==key.toLowerCase()){if(value==null){value=""}$("#"+dcArr[i]).attr("value",value);var disabled=$("#"+dcArr[i]).attr("disabled");if(disabled){var resultInput=$("#"+dcArr[i]).next("input[disablefield='true']");$(resultInput).attr("value",value)}}else{if(arr[i]==key){$("#"+dcArr[i]).attr("value",value);var disabled=$("#"+dcArr[i]).attr("disabled");if(disabled){var resultInput=$("#"+dcArr[i]).next("input[disablefield='true']");$(resultInput).attr("value",value)}}}}}})}else{var arr=dataField.split(",");var dcArr=dataControl.split(",");for(var i=0;i<arr.length;i++){if(arr[i]!=""){$("#"+dcArr[i]).attr("value","");var disabled=$("#"+dcArr[i]).attr("disabled");if(disabled){var resultInput=$("#"+dcArr[i]).next("input[disablefield='true']");$(resultInput).attr("value",value)}}}}},error:function(XMLHttpRequest,textStatus){alert(textStatus)}})}}function addUsers(treeType,multiple,value,resultId,hiddenResultId,inputType){if(resultId!=""){inputType=="textArea"?$("#"+resultId).html(""):$("#"+resultId).attr("value","")}var type="";if(treeType=="COMPANY"||treeType.substring(0,treeType.indexOf("_"))=="MAN"){type="user"}else{if(treeType.substring(0,treeType.indexOf("_"))=="DEPARTMENT"){type="department"}else{if(treeType.substring(0,treeType.indexOf("_"))=="GROUP"){type="workGroup"}}}var arr=eval(value);if(multiple=="true"){for(var i=0;i<arr.length;i++){if(type=="user"&&(arr[i].type=="user"||arr[i].type=="allDepartment"||arr[i].type=="company")){if(arr[i].type=="user"){if(resultId!=""){inputType=="textArea"?$("#"+resultId).html($("#"+resultId).html()+arr[i].name+","):$("#"+resultId).attr("value",$("#"+resultId).attr("value")+arr[i].name+",")}$("#"+hiddenResultId).attr("value",$("#"+hiddenResultId).attr("value")+arr[i].loginName+",")}else{if(arr[i].type=="allDepartment"||arr[i].type=="company"){if(resultId!=""){inputType=="textArea"?$("#"+resultId).html("\u6240\u6709\u4eba\u5458,"):$("#"+resultId).attr("value","\u6240\u6709\u4eba\u5458,")}$("#"+hiddenResultId).attr("value","all_user,");break}}}else{if(type=="department"&&(arr[i].type=="department"||arr[i].type=="allDepartment"||arr[i].type=="company")){if(arr[i].type=="department"){if(resultId!=""){inputType=="textArea"?$("#"+resultId).html($("#"+resultId).html()+arr[i].name+","):$("#"+resultId).attr("value",$("#"+resultId).attr("value")+arr[i].name+",")}$("#"+hiddenResultId).attr("value",$("#"+hiddenResultId).attr("value")+arr[i].id+",")}else{if(arr[i].type=="allDepartment"||arr[i].type=="company"){inputType=="textArea"?$("#"+resultId).html("\u6240\u6709\u90e8\u95e8,"):$("#"+resultId).attr("value","\u6240\u6709\u90e8\u95e8,");$("#"+hiddenResultId).attr("value","all_department,");break}}}else{if(type=="workGroup"&&(arr[i].type=="workGroup"||arr[i].type=="allWorkGroup"||arr[i].type=="company")){if(arr[i].type=="workGroup"){if(resultId!=""){inputType=="textArea"?$("#"+resultId).html($("#"+resultId).html()+arr[i].name+","):$("#"+resultId).attr("value",$("#"+resultId).attr("value")+arr[i].name+",")}$("#"+hiddenResultId).attr("value",$("#"+hiddenResultId).attr("value")+arr[i].id+",")}else{if(arr[i].type=="allWorkGroup"||arr[i].type=="company"){if(resultId!=""){inputType=="textArea"?$("#"+resultId).html("\u6240\u6709\u5de5\u4f5c\u7ec4,"):$("#"+resultId).attr("value","\u6240\u6709\u5de5\u4f5c\u7ec4,")}$("#"+hiddenResultId).attr("value","all_workGroup,");break}}}}}}if(inputType=="textArea"){if(resultId!=""&&$("#"+resultId).html()!=""){$("#"+resultId).html($("#"+resultId).html().substring(0,$("#"+resultId).html().length-1))}}else{if(resultId!=""&&$("#"+resultId).attr("value")!=""&&$("#"+resultId).attr("value")!=null){$("#"+resultId).attr("value",$("#"+resultId).attr("value").substring(0,$("#"+resultId).attr("value").length-1))}}if($("#"+hiddenResultId).attr("value")!=""&&$("#"+hiddenResultId).attr("value")!=null){$("#"+hiddenResultId).attr("value",$("#"+hiddenResultId).attr("value").substring(0,$("#"+hiddenResultId).attr("value").length-1))}}else{if(multiple=="false"){if(resultId!=""){if(inputType=="textArea"){$("#"+resultId).html(arr[0].name)}else{$("#"+resultId).attr("value",arr[0].name)}}if(type=="user"&&arr[0].type=="user"){$("#"+hiddenResultId).attr("value",arr[0].loginName)}else{if(type=="department"&&arr[0].type=="department"){$("#"+hiddenResultId).attr("value",arr[0].id)}else{if(type=="workGroup"&&arr[0].type=="workGroup"){$("#"+hiddenResultId).attr("value",arr[0].id)}}}}}}function ___initHiddenListControl(b){var c=$("input[pluginType=LIST_CONTROL]");for(var a=0;a<c.length;a++){if($(c[a]).attr("data_source")==b){$(c[a]).css("display","none")}}}function parseListControl(c){var d=$("input[pluginType=LIST_CONTROL]");var f=$(window).width()-260;for(var g=0;g<d.length;g++){var a=$(d[g]).attr("id");if($("table[id='tb_"+a+"']").length<=0){$(d[g]).css("display","none");var p="<input type=hidden name='dataSrc_"+$(d[g]).attr("id")+"' id='dataSrc_"+$(d[g]).attr("id")+"' value='"+$(d[g]).attr("data_source")+"'>";$(d[g]).after(p);var k=$(d[g]).attr("lv_title");var m=$(d[g]).attr("lv_size");var n=$(d[g]).attr("lv_sum");var b=$(d[g]).attr("lv_cal");var h=$(d[g]).attr("lv_field");var q="<div style='width:"+f+"px;overflow: auto;'>";q+="<table class='form-table-border-left' id='tb_"+a+"'><thead><tr>";var l=k.split(",");var o=m.split(",");for(var e=0;e<l.length;e++){if(l[e]!=""){q+="<th style='width:"+o[e]+"px;white-space: nowrap;'>";q+=l[e]+"</th>"}}q+="<th style='width:30px;white-space: nowrap;'>&nbsp;&nbsp;\u64cd&nbsp;\u4f5c&nbsp;&nbsp;</th></tr></thead><tbody>";q+=getListControlRow("tb_"+a,n,h,b,c);if(isNeedSum(n)){q+=listControlAddSumRow("tb_"+a,n)}q+="</tbody></table></div>";$("#dataSrc_"+$(d[g]).attr("id")).after(q)}}}function ___executeDatepicker(a){$("#"+a).datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,showButtonPanel:"true"})}function ___executeDatetimepicker(a){$("#"+a).datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,showSecond:false,showMillisec:false,timeFormat:"hh:mm"})}function getListControlRow(c,l,j,d,e){var k=j.split(",");var g=$("\"tr[id^='listControl_tr_']\"").length>0?$("\"tr[id^='listControl_tr_']\"").length:0;var f=d.split(",");var b=l.split(",");var n="<tr id='listControl_tr_"+c+"_"+g+"'>";for(var h=0;h<k.length;h++){if(k[h]!=""){var a=c.substring(c.indexOf("_")+1,c.length);n+="<td>";var o=k[h].substring(k[h].indexOf(":")+1,k[h].length);var m="listControl_"+c+"_"+g+"_"+(h+1);if(o=="DATE"||o=="TIME"){if(f[h]=="0"){if(o=="DATE"){n+="<input style='width:95%;' rowid='' name='listControl_"+a+"_"+k[h]+"' id='"+m+"' readonly";n+="></input>";n+='<script type="text/javascript">$("#'+m+'").datepicker({"dateFormat":"yy-mm-dd",  changeMonth:true, changeYear:true,	showButtonPanel:"true"});<\/script>'}else{n+="<input style='width:95%;' rowid='' name='listControl_"+a+"_"+k[h]+"' id='"+m+"' readonly";n+="></input>";n+='<script type="text/javascript">$("#'+m+'").datetimepicker({"dateFormat":"yy-mm-dd",      changeMonth:true,     changeYear:true,     showSecond: false,	showMillisec: false,	"timeFormat": "hh:mm"});<\/script>'}}else{n+="<input style='width:95%;' rowid='' name='listControl_"+a+"_"+k[h]+"' id='listControl_"+c+"_"+g+"_"+(h+1)+"' readonly";n+="></input>"}}else{n+="<input style='width:95%;' rowid='' name='listControl_"+a+"_"+k[h]+"' id='listControl_"+c+"_"+g+"_"+(h+1)+"'";if(f[h]!="0"){n+=" readonly"}else{n+=customListAddEven(a,k[h],b[h],g,(h+1),d,j)}n+="></input>"}n+="</td>"}}n+="<td>";if(e=="true"){n+='<a href="#pos" class="small-button-bg" onclick="listControlAddRow(this,\''+c+"','"+l+"','"+j+"','"+d+"','"+e+'\');"><span class="ui-icon ui-icon-plusthick"></span></a>';n+="&nbsp;";n+='<a href="#pos" class="small-button-bg" onclick="listControlDelRow(this,\''+c+"','"+l+"','"+j+"','','');\"><span class=\"ui-icon ui-icon-minusthick\"></span></a>"}n+="</td></tr>";return n}function customListAddEven(h,g,c,b,e,d,f){var a=(g.split(":"))[1];if("INTEGER"==a||"LONG"==a||"DOUBLE"==a||"FLOAT"==a){return" onkeyup='customListAddCellEven(\""+h+'","'+g+'","'+c+'","'+b+'","'+e+'","'+d+'","'+f+"\");'"}return""}function customListAddCellEven(a,e,i,c,g,b,f){var h="listControlSum_tb_"+a+"_td_"+g;var k="listControl_"+a+"_"+e;var d="listControl_tb_"+a+"_"+c+"_"+g;var j=(e.split(":"))[1];if("INTEGER"==j||"LONG"==j){if(!(_isInteger($("#"+d).attr("value")))){$("#"+d).attr("value","")}}else{if("DOUBLE"==j||"FLOAT"==j){if(!(_isFloating($("#"+d).attr("value")))){$("#"+d).attr("value","")}}}if("1"==i){customListEven(h,k)}customListAddCalculateEven(a,e,c,g,b,f)}function customListAddCalculateEven(id,lv_field,tr_num,td_num,lv_cal,lv_fields){var calculate=lv_cal.substring(0,lv_cal.length-1);var calculates=calculate.split(",");var fieldDetails=lv_fields.substring(0,lv_fields.length-1);var tempCalculates="";for(var i=0;i<calculates.length;i++){if(calculates[i]!="0"){tempCalculates=calculates[i];var cal=customListParseCalculateFormula(calculates[i]);if(cal!=""){cal=cal.substring(0,cal.length-1);var cals=cal.split(",");for(var j=0;j<cals.length;j++){var tempCellValue=getCustomListCalculateCellValue(fieldDetails,cals[j],id,tr_num);tempCalculates=tempCalculates.replace("["+cals[j]+"]",tempCellValue)}}if(tempCalculates!=""){var calculateFieldCellId="listControl_tb_"+id+"_"+tr_num+"_"+(i+1);$("#"+calculateFieldCellId).attr("value",eval(tempCalculates));var totalColumnId="listControlSum_tb_"+id+"_td_"+(i+1);var fieldsName=$("#"+calculateFieldCellId).attr("name");customListEven(totalColumnId,fieldsName)}}}}function getCustomListCalculateCellValue(f,d,g,c){var b=f.split(",");var a="";for(var e=0;e<b.length;e++){if((e+1)==parseInt(d)){a=parseCustomListCalculateValue(b[e],g,c,d);break}}return a}function parseCustomListCalculateValue(f,g,b,c){var a=f.split(":")[1];var e="listControl_tb_"+g+"_"+b+"_"+c;var d=$("#"+e).attr("value");if("INTEGER"==a||"LONG"==a){return"parseInt("+(d==""?0:d)+")"}else{if("DOUBLE"==a||"FLOAT"==a){return"parseFloat("+(d==""?0:d)+")"}}return"parseInt(0)"}function customListParseCalculateFormula(b){if(b.indexOf("[")==-1){return""}var a=b.substring(b.indexOf("[")+1,b.indexOf("]"));b=b.replace("["+a+"]","");return a+","+customListParseCalculateFormula(b)}function _isInteger(a){var b=new RegExp("^-?[1-9]\\d*$");return b.test(a)}function _isFloating(b){var a=new RegExp("^[+-]?([0-9]*.?[0-9]+|[0-9]+.?[0-9]*)([eE][+-]?[0-9]+)?$");return a.test(b)}function customListEven(f,c){var a=(c.split(":"))[1];var e=$('input[name="'+c+'"]');var b=0;for(var d=0;d<e.length;d++){b+=parseCustomListCellValue(a,$(e[d]).val())}$("#"+f).attr("value",b)}function parseCustomListCellValue(a,b){if("INTEGER"==a||"LONG"==a){return parseInt(b==""?0:b)}else{if("DOUBLE"==a||"FLOAT"==a){return parseFloat(b==""?0:b)}}return 0}function listControlAddRow(d,f,a,e,c,b){$(d).parent().parent().after(getListControlRow(f,a,e,c,b))}function addCalEvent(a,h,d,b){var c=b.split(",");var g=$("#"+a+" tbody tr");var f;if(isNeedSum(h)){f=$(g[g.length-2]).find("input")}else{f=$(g[g.length-1]).find("input")}for(var e=0;e<f.length;e++){if($(f[e]).attr("readonly")){var j=getLCComponentInputs(a,c[e],$(f[e]).attr("id"),d);parseLCComputational(j[0],j[1],$(f[e]).attr("id"),h,"#listControlSum_"+a+"_td_","listControl_"+a+"_",a)}}}function isNeedSum(a){var c=a.split(",");for(var b=0;b<c.length;b++){if(c[b]!=""){if(c[b]=="1"){return true}}}return false}function getLCComponentInputs(b,a,c,d){var h=$("\"input[id^='listControl_"+b+"_"+d+"']\"");var f=a;var l=new Array();var g=new Array();for(var e=1;e<50;e++){if(e>h.length){break}else{if(!$(h[e-1]).attr("readonly")){var k=new RegExp("([(+*/^,-]*)[[]+"+e+"[]]+([)+*/^,-]*)","g");var j=$(h[e-1]).attr("id");a=a.replace(k,"$1(isNaN(parseInt($('#"+j+"').attr('value')))?0:parseInt($('#"+j+"').attr('value')))$2");if(a!=f){g.push($(h[e-1]))}}}}l.push(g);l.push(a);return l}function parseLCComputational(componentInputs,computational,id,lv_sum,preSumId,preInputCeil,tb_id){for(var i=0;i<componentInputs.length;i++){$(componentInputs[i]).change(function(){$("#"+id).attr("value",eval(computational));var lv_sums=lv_sum.split(",");for(var j=0;j<lv_sums.length;j++){if(lv_sums[j]!=""||lv_sums[j]!="0"){if(lv_sums[j]=="1"){var sum=0;var trs=$("#"+tb_id+" tbody tr");for(var n=0;n<trs.length-1;n++){var inputCeil=isNaN(parseInt($("#"+preInputCeil+n+"_"+(j+1)).attr("value")))?0:parseInt($("#"+preInputCeil+n+"_"+(j+1)).attr("value"));$(this).attr("value");sum+=inputCeil}$(preSumId+(j+1)).attr("value",sum)}}}})}}function listControlAddSumRow(f,a){a=a.substring(0,a.length-1);var c=a.split(",");var d="<tr id='listControlSum_"+f+"'>";for(var b=0;b<c.length;b++){if("1"==c[b]){d+="<td><input style='width:95%;' readonly ";var e=f.substring(f.indexOf("_")+1,f.length);d+="id='listControlSum_"+f+"_td_"+(b+1)+"' name='listControlSum_"+e+"_"+(b+1)+"' value='0'";d+="></input></td>"}else{d+="<td></td>"}}d+="<td>\u5408\u8ba1</td></tr>";return d}function listControlDelRow(e,h,b,f,d,g){var c=$("#"+h+" tbody tr");var a=$("\"tr[id^='listControl_tr_']\"").length>0?$("\"tr[id^='listControl_tr_']\"").length:0;if(a>1){$(e).parent().parent().remove();if(isNeedSum(b)){totalAllRow(h,b,f)}}if(d!=""&&g!=""){listControlDeleteRow(d,g)}}function listControlDeleteRow(a,b){$.ajax({type:"POST",url:webRoot+"/common/custom-list-control-deleteRow.htm",data:{dataTableName:b,dataId:a},success:function(c,d){},error:function(c,d){alert(d)}})}function totalAllRow(a,h,f){var g=f.split(",");var c=h.split(",");for(var e=0;e<c.length;e++){if("1"==c[e]){var b=a.substring(a.indexOf("_")+1,a.length);var d="listControlSum_"+a+"_td_"+(e+1);var j="listControl_"+b+"_"+g[e];customListEven(d,j)}}}function controlsExistFun(d){var a=d.split(",");var c=true;for(var b=0;b<a.length;b++){if(a[b]!=""){if($("#"+a[b]).size()<=0||$("input[id='"+a[b]+"']").length<=0){alert("id\u4e3a"+a[b]+"\u7684\u5355\u884c\u6587\u672c\u63a7\u4ef6\u5b58\u5728,\u8bf7\u5728\u8868\u5355\u7f16\u8f91\u754c\u9762\u589e\u52a0\u8be5\u63a7\u4ef6.");c=false;return}}}return c}function dataSelectionClick(a,c,b){if(controlsExistFun(b)){$.colorbox({href:a,iframe:true,width:500,height:400,overlayClose:false,title:c})}}function deptSelectCallback(f,e,d,a,c){if(d=="COMPANY"||d=="MAN_DEPARTMENT_GROUP_TREE"||d=="MAN_DEPARTMENT_TREE"||d=="MAN_GROUP_TREE"){if(c=="userId"){if(a=="false"){$("#"+f).attr("value",jstree.getId())}else{var b=$("#"+f).val();if(b!="ALLCOMPANYID"&&b!="ALLWORKGROUP"){$("#"+f).attr("value",jstree.getIds())}}}else{if(a=="false"){$("#"+f).attr("value",jstree.getLoginName())}else{var b=$("#"+f).val();if(b!="ALLCOMPANYID"&&b!="ALLWORKGROUP"){$("#"+f).attr("value",jstree.getLoginNames())}}}}else{if(d=="DEPARTMENT_TREE"){if(c=="userId"){if(a=="false"){$("#"+f).attr("value",jstree.getDepartmentId())}else{$("#"+f).attr("value",jstree.getDepartmentIds())}}else{if(a=="false"){$("#"+f).attr("value",jstree.getDepartmentName())}else{$("#"+f).attr("value",jstree.getDepartmentNames())}}}else{if(d=="GROUP_TREE"){if(c=="userId"){if(a=="false"){$("#"+f).attr("value",jstree.getWorkgroupId())}else{$("#"+f).attr("value",jstree.getWorkgroupIds())}}else{if(a=="false"){$("#"+f).attr("value",jstree.getWorkgroupName())}else{$("#"+f).attr("value",jstree.getWorkgroupNames())}}}}}}function deptZtreeSelectCallback(f,e,d,a,c){if(f){if(d=="COMPANY"||d=="MAN_DEPARTMENT_TREE"||d=="MAN_GROUP_TREE"){if(c=="userId"){if(a=="false"){$("#"+f).attr("value",ztree.getId())}else{var b=$("#"+f).val();if(b!="ALLCOMPANYID"&&b!="ALLWORKGROUP"){$("#"+f).attr("value",ztree.getIds())}}}else{if(a=="false"){$("#"+f).attr("value",ztree.getLoginName())}else{var b=$("#"+f).val();if(b!="ALLCOMPANYID"&&b!="ALLWORKGROUP"){$("#"+f).attr("value",ztree.getLoginNames())}}}}else{if(d=="DEPARTMENT_TREE"){if(c=="userId"){if(a=="false"){$("#"+f).attr("value",ztree.getDepartmentId())}else{$("#"+f).attr("value",ztree.getDepartmentIds())}}else{if(a=="false"){$("#"+f).attr("value",ztree.getDepartmentName())}else{$("#"+f).attr("value",ztree.getDepartmentNames())}}}else{if(d=="GROUP_TREE"){if(c=="userId"){if(a=="false"){$("#"+f).attr("value",ztree.getWorkGroupId())}else{$("#"+f).attr("value",ztree.getWorkGroupIds())}}else{if(a=="false"){$("#"+f).attr("value",ztree.getWorkGroupName())}else{$("#"+f).attr("value",ztree.getWorkGroupNames())}}}}}}}function calTextareaLen(b,a,c){b=b.length>a?b.substring(0,a):b;$("#"+c.id).attr("value",b)}function ___initControls(b,a){__initSignatureControl(b);__imageControls();__hiddenJCControls();if(a){__btnControls()}initLabelControl()}function __initSignatureControl(c){$("input[pluginType='SIGNATURE_CONTROL']").css("display","none");if(c){var g=__signatureFields.split(",");for(var b=0;b<g.length;b++){var a=$("input[signaturevisible=true]");for(var d=0;d<a.length;d++){if(g[b]==$(a[d]).attr("name")){$(a[d]).css("display","none");$("input[resultid='"+g[b]+"']").css("display","none")}}a=$("input[pluginType='SIGNATURE_CONTROL']");var f="";var e="";for(var d=0;d<a.length;d++){if(g[b]==$(a[d]).attr("id")){$(a[d]).css("display","none");f=$(a[d]).attr("hiddenId");e=$(a[d]).attr("resultId");$("input[id='"+f+"']").css("display","none");$("input[id='"+e+"']").css("display","none");$("input[hiddenId='"+f+"']").css("display","none");$("input[resultid='"+e+"']").css("display","none")}}}}}function __imageControls(){var c=$("img[pluginType='IMAGE']");for(var b=0;b<c.length;b++){var a=$(c[b]).attr("filename");$(c[b]).attr("src",imatrixRoot+"/"+a)}}function __hiddenJCControls(){$("img[pluginType='JAVASCRIPT_CSS']").css("display","none")}function __btnControls(){$("input[plugintype='DATA_ACQUISITION']").css("display","none");$("input[plugintype='DATA_SELECTION']").css("display","none");$("input[plugintype='BUTTON']").css("display","none");$("input[plugintype='STANDARD_LIST_CONTROL']").css("display","none")}function ___initUploadControl(l,d,n,h,c,e,m,b,k,f){if(e=="false"){var g=c.substring(c.lastIndexOf("_")+1,c.length);var a="spanButtonPlaceholder_"+g;var i=document.getElementById(a);var j="\u8bf7\u4e0a\u4f20\u6587\u4ef6";if(b=="IMAGE_UPLOAD"){d=50;j="\u8bf7\u4e0a\u4f20\u56fe\u7247";n="*.png;*.jpg;*.jpeg;*.bmp;*.gif";h="\u8bf7\u4e0a\u4f20png,jpg,jpeg,bmp,gif\u683c\u5f0f\u7684\u56fe\u7247"}if(i!=undefined){new SWFUpload({upload_url:l,post_params:{name:"\u53c2\u6570"},file_post_name:"Filedata",file_size_limit:d+" MB",file_types:n,file_types_description:h,file_upload_limit:"0",file_queue_error_handler:fileQueueError,file_dialog_complete_handler:fileDialogComplete,file_queued_handler:fileQueued,upload_progress_handler:uploadProgress,upload_error_handler:uploadError,upload_success_handler:uploadSuccess,upload_complete_handler:uploadComplete,button_image_url:imatrixRoot+"/images/annex.gif",button_placeholder_id:a,button_width:250,button_height:18,button_text:'<span class="button">'+j+"(\u6700\u5927"+d+"MB)</span>",button_text_style:".button {border:1px solid #91B8D2;color:#2970A6;  }",button_text_top_padding:0,button_text_left_padding:18,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,flash_url:imatrixRoot+"/widgets/swfupload/swfupload.swf",custom_settings:{upload_target:"divFileProgressContainer_"+g,tableId:c,controlId:m,pluginType:b,imageWidth:k,imageHeight:f,isUpload:true},debug:false})}}}function fileDialogBefore(b,a){formAttachFileDialogBefore(b,a)}function formAttachFileDialogBefore(d,b){var a=b.customSettings.upload_target;if(typeof(a)!="undefined"&&a.indexOf("divFileProgressContainer_")>=0){var g=$("#id").attr("value");var c=$("#__attachInfo").attr("value");if(g==""||typeof(g)=="undefined"){alert("\u8bf7\u5148\u4fdd\u5b58")}else{var e=b.customSettings.controlId;var f=b.customSettings.pluginType;b.customSettings.isUpload=true;b.setPostParams({attachInfo:c,controlId:e,pluginType:f});b.startUpload()}}}function rewriteMethod(b,a){formAttachRewriteMethod(b,a)}function formAttachRewriteMethod(file,swfObject){var upload_target=swfObject.customSettings.upload_target;if(typeof(upload_target)!="undefined"&&upload_target.indexOf("divFileProgressContainer_")>=0){$("#"+upload_target).html("");var tableId=swfObject.customSettings.tableId;var controlId=swfObject.customSettings.controlId;var pluginType=swfObject.customSettings.pluginType;var imageWidth=swfObject.customSettings.imageWidth;var imageHeight=swfObject.customSettings.imageHeight;var companyId=$("#"+tableId).attr("companyId");var userId=$("#"+tableId).attr("userId");var attachInfo=$("#__attachInfo").attr("value");$.getJSON(imatrixRoot+"/mms/form/getAttachments.htm?fileCompanyId="+companyId+"&fileUserId="+userId+"&attachInfo="+attachInfo+"&controlId="+controlId+"&pluginType="+pluginType+"&callback=?",function(data){$("#"+tableId+"_body").find("tr").remove();var files=eval(data.data);if(pluginType=="ATTACH_UPLOAD"){_____getAttachTbContent(files,tableId,pluginType)}else{if(pluginType=="IMAGE_UPLOAD"){_____getImageTbContent(files,tableId,imageWidth,imageHeight,pluginType)}}})}}function _____getAttachTbContent(d,c,h){for(var a=0;a<d.length;a++){var g="<tr id="+d[a].id+" >";var f="<td >"+d[a].fileName+"</td>";var b="<td ><a href='#' onclick='____downloadFile(\""+d[a].id+'","'+h+"\");'>\u4e0b\u8f7d</a>&nbsp;&nbsp;<a href='#' onclick='____deleteFile(\""+d[a].id+'","'+c+'","'+h+"\");'>\u5220\u9664</a></td>";var e="</tr>";$("#"+c+"_body").append(g+f+b+e)}}function _____getImageTbContent(a,c,j,g,b){for(var d=0;d<a.length;d++){var l="<tr id="+a[d].id+" >";var h="<td >"+a[d].fileName+"</td>";var f="<td ><img src='"+imatrixRoot+"/"+a[d].filePath+"' width='"+j+"' height='"+g+"'/></td>";var e="<td ><a href='#' onclick='____downloadFile(\""+a[d].id+'","'+b+"\");'>\u4e0b\u8f7d</a>&nbsp;&nbsp;<a href='#' onclick='____deleteFile(\""+a[d].id+'","'+c+'","'+b+"\");'>\u5220\u9664</a></td>";var k="</tr>";$("#"+c+"_body").append(l+h+f+e+k)}}function ____deleteFile(a,b,c){if(confirm("\u786e\u8ba4\u5220\u9664?")){$.getJSON(imatrixRoot+"/mms/form/deleteAttachment.htm?fileId="+a+"&pluginType="+c+"&callback=?",function(d){$("#"+b+"_body").find("tr[id='"+a+"']").remove();alert(d.msg)})}}function ____downloadFile(a,b){window.open(imatrixRoot+"/mms/form/downloadAttachment.htm?fileId="+a+"&pluginType="+b)}function destroyUploadControl(){for(var a=0;a<SWFUpload.movieCount;a++){SWFUpload.instances["SWFUpload_"+a].destroy()}}function fieldNameOk(a){$("#controlId").attr("value",$(a).attr("value"))}function formPrintHideControl(){$("input").css("display","none");$("select[pluginType=PULLDOWNMENU]").css("display","none");$("textarea[pluginType=textarea]").css("display","none")}function initLabelControl(){var b=$("input[pluginType=LABEL]");for(var a=0;a<b.length;a++){$(b[a]).after("<span style='"+$(b[a]).attr("style")+"' class='"+$(b[a]).attr("class")+"'>"+$(b[a]).attr("value")+"</span>")}$("input[pluginType=LABEL]").css("display","none")}function initPrintLabelControl(){var b=$("input[pluginType=LABEL]");for(var a=0;a<b.length;a++){if($(b[a]).attr("printable")=="true"){$(b[a]).after("<span style='"+$(b[a]).attr("style")+"' class='"+$(b[a]).attr("class")+"'>"+$(b[a]).attr("value")+"</span>")}}$("input[pluginType=LABEL]").css("display","none")}function __parseCustomDateTypeValue(){$("input[parseafter='parseafter']").remove();var a=$("input[pluginType=TIME]");if(a.length==0){return}$.each(a,function(c){var b=$(a[c]).attr("customtype");if("CUSTOM"==b){__parseDateValueByCustomType($(a[c]),$(a[c]).attr("format"))}})}function __parseDateValueByCustomType(a,b){if("yyyy-m"==b){timeFormatYearMonthStandard(a)}else{if("m-d"==b){timeFormatMonthDayStandard(a)}else{if("yyyy\u5e74m\u6708d\u65e5"==b){timeFormatYearMonthDayCommon(a)}else{if("yyyy\u5e74m\u6708"==b){timeFormatYearMonthCommon(a)}else{if("m\u6708d\u65e5"==b){timeFormatMonthDayCommon(a)}else{if("\u4e8cO\u4e00\u56db\u5e74\u4e00\u6708\u4e00\u65e5"==b){timeFormatYearMonthDayCH(a)}else{if("\u4e8cO\u4e00\u56db\u5e74\u4e00\u6708"==b){timeFormatYearMonthCH(a)}else{if("\u4e00\u6708\u4e00\u65e5"==b){timeFormatMonthDayCH(a)}else{if("h:mm"==b){timeFormatHourMinuteStandard(a)}else{if("h\u65f6mm\u5206"==b){timeFormatHourMinuteCommon(a)}}}}}}}}}}}function timeFormatHourMinuteCommon(b){var a=$(b).val();if(a!=""){a=__getCurrentYearMonthDay()+" "+a.replace("\u65f6",":").replace("\u5206","");resettingParseAfterValue(b,a)}}function timeFormatHourMinuteStandard(b){var a=$(b).val();if(a!=""){a=__getCurrentYearMonthDay()+" "+a;resettingParseAfterValue(b,a)}}function timeFormatMonthDayCH(d){var c=$(d).val();if(c!=""){var e=c.substring(0,c.indexOf("\u6708"));var b=c.substring(c.indexOf("\u6708")+1,c.indexOf("\u65e5"));var a="";a+=__getCurrentYear()+"-";a+=e.length==1?"0"+__hanziToShuzi(e):__hanziToShuzi(e);a+="-";a+=b.length==1?"0"+__hanziToShuzi(b):__hanziToShuzi(b);a+=" 00:00";resettingParseAfterValue(d,a)}}function timeFormatYearMonthCH(e){var d=$(e).val();if(d!=""){var c=d.substring(0,d.indexOf("\u5e74"));var f=d.substring(d.indexOf("\u5e74")+1,d.indexOf("\u6708"));var a="";for(var b=0;b<c.length;b++){a+=__hanziToShuzi(c.charAt(b))}a+="-";a+=f.length==1?"0"+__hanziToShuzi(f):__hanziToShuzi(f);a+="-01 00:00";resettingParseAfterValue(e,a)}}function timeFormatYearMonthDayCH(f){var e=$(f).val();if(e!=""){var d=e.substring(0,e.indexOf("\u5e74"));var g=e.substring(e.indexOf("\u5e74")+1,e.indexOf("\u6708"));var b=e.substring(e.indexOf("\u6708")+1,e.indexOf("\u65e5"));var a="";for(var c=0;c<d.length;c++){a+=__hanziToShuzi(d.charAt(c))}a+="-";a+=g.length==1?"0"+__hanziToShuzi(g):__hanziToShuzi(g);a+="-";a+=b.length==1?"0"+__hanziToShuzi(b):__hanziToShuzi(b);a+=" 00:00";resettingParseAfterValue(f,a)}}function timeFormatMonthDayCommon(b){var a=$(b).val();if(a!=""){a=__getCurrentYear()+"-"+a.replace("\u6708","-").replace("\u65e5","")+" 00:00";resettingParseAfterValue(b,a)}}function timeFormatYearMonthCommon(b){var a=$(b).val();if(a!=""){a=a.replace("\u5e74","-").replace("\u6708","-")+"01 00:00";resettingParseAfterValue(b,a)}}function timeFormatYearMonthDayCommon(b){var a=$(b).val();if(a!=""){a=a.replace("\u5e74","-").replace("\u6708","-").replace("\u65e5","")+" 00:00";resettingParseAfterValue(b,a)}}function timeFormatMonthDayStandard(b){var a=$(b).val();if(a!=""){a=__getCurrentYear()+"-"+a+" 00:00";resettingParseAfterValue(b,a)}}function timeFormatYearMonthStandard(b){var a=$(b).val();if(a!=""){a=a+"-01 00:00'";resettingParseAfterValue(b,a)}}function resettingParseAfterValue(c,b){var a="<input parseafter='parseafter' type='hidden' name='"+$(c).attr("name")+"' value='"+b+"'/>";$(c).after(a);$(c).attr("name","")}function __getCurrentYear(){var a=new Date();return a.getFullYear()}function __getCurrentYearMonthDay(){var b=new Date();var c=b.getFullYear();var d=b.getMonth()+1;d=(d<10?"0"+d:d);var a=b.getDate();return c.toString()+"-"+d.toString()+"-"+a}function __hanziToShuzi(a){if("O"==a){return"0"}else{if("\u4e00"==a){return"1"}else{if("\u4e8c"==a){return"2"}else{if("\u4e09"==a){return"3"}else{if("\u56db"==a){return"4"}else{if("\u4e94"==a){return"5"}else{if("\u516d"==a){return"6"}else{if("\u4e03"==a){return"7"}else{if("\u516b"==a){return"8"}else{if("\u4e5d"==a){return"9"}else{if("\u5341"==a){return"10"}else{if("\u5341\u4e00"==a){return"11"}else{if("\u5341\u4e8c"==a){return"12"}else{if("\u5341\u4e09"==a){return"13"}else{if("\u5341\u56db"==a){return"14"}else{if("\u5341\u4e94"==a){return"15"}else{if("\u5341\u516d"==a){return"16"}else{if("\u5341\u4e03"==a){return"17"}else{if("\u5341\u516b"==a){return"18"}else{if("\u5341\u4e5d"==a){return"19"}else{if("\u4e8c\u5341"==a){return"20"}else{if("\u4e8c\u5341\u4e00"==a){return"21"}else{if("\u4e8c\u5341\u4e8c"==a){return"22"}else{if("\u4e8c\u5341\u4e09"==a){return"23"}else{if("\u4e8c\u5341\u56db"==a){return"24"}else{if("\u4e8c\u5341\u4e94"==a){return"25"}else{if("\u4e8c\u5341\u516d"==a){return"26"}else{if("\u4e8c\u5341\u4e03"==a){return"27"}else{if("\u4e8c\u5341\u516b"==a){return"28"}else{if("\u4e8c\u5341\u4e5d"==a){return"29"}else{if("\u4e09\u5341"==a){return"30"}else{if("\u4e09\u5341\u4e00"==a){return"31"}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return""};
