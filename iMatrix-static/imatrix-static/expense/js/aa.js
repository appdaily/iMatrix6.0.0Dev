function AjaxAnywhere(){this.id=AjaxAnywhere.defaultInstanceName;this.formName=null;this.notSupported=false;this.delayBeforeContentUpdate=true;this.delayInMillis=100;this.callbackExecuted=true;if(window.XMLHttpRequest){this.req=new XMLHttpRequest()}else{if(window.ActiveXObject){try{this.req=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{this.req=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){this.notSupported=true}}}}if(this.req==null||typeof this.req=="undefined"){this.notSupported=true}}AjaxAnywhere.defaultInstanceName="default";AjaxAnywhere.ASYNCH_KEY="automated.test.session=false";AjaxAnywhere.SYNCH_KEY="automated.test.session=true";AjaxAnywhere.parseQueryString=function(){if(location.href.indexOf(AjaxAnywhere.ASYNCH_KEY)!=-1){document.cookie=AjaxAnywhere.ASYNCH_KEY}else{if(location.href.indexOf(AjaxAnywhere.SYNCH_KEY)!=-1){document.cookie=AjaxAnywhere.SYNCH_KEY}}};AjaxAnywhere.parseQueryString();AjaxAnywhere.prototype.isAsynch=function(){return document.cookie.indexOf(AjaxAnywhere.SYNCH_KEY)==-1};AjaxAnywhere.prototype.substitutedSubmitButtons=new Array();AjaxAnywhere.prototype.substitutedSubmitButtonsInfo=new Object();AjaxAnywhere.prototype.findForm=function(){var a;if(this.formName!=null){a=document.forms[this.formName]}else{if(document.forms.length>0){a=document.forms[0]}}if(typeof a!="object"){alert("AjaxAnywhere error: Form with name ["+this.formName+"] not found")}return a};AjaxAnywhere.prototype.bindById=function(){var a="AjaxAnywhere."+this.id;window[a]=this};AjaxAnywhere.findInstance=function(b){var a="AjaxAnywhere."+b;return window[a]};AjaxAnywhere.prototype.submitAJAX=function(f,d){if(this.notSupported){return this.onSubmitAjaxNotSupported(f,d)}if(f==null||typeof f=="undefined"){f=""}this.bindById();var e=this.findForm();var g=e.attributes.action;var c=g==null?null:g.nodeValue;if((c==null)||(c=="")){c=location.href}var h=c.indexOf("#");if(h!=-1){c=c.substring(0,h)}if((c==null)||(c=="")){c=location.href}h=c.indexOf("#");if(h!=-1){c=c.substring(0,h)}var b=this.getZonesToReload(c,d);if(b==null){this.submitOld(e,d);return}this.dropPreviousRequest();this.req.open("POST",c,this.isAsynch());this.req.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");var a=this.preparePostData(d);if(b!=""){a="&aazones="+encodeURIComponent(b)+"&"+a+"&"+f}else{a+="&"+f}this.sendPreparedRequest(a)};AjaxAnywhere.prototype.getAJAX=function(c,a){if(this.notSupported){return this.onGetAjaxNotSupported(c)}this.bindById();if(a==null||typeof a=="undefined"){a=""}var b=this.getZonesToReload(c);if(b==null){location.href=c;return}if(b.length!=0){a+=","+b}this.dropPreviousRequest();c+=(c.indexOf("?")!=-1)?"&":"?";c+="aaxmlrequest=true&aa_rand="+Math.random();if(a!=null&&a!=""){c+="&aazones="+encodeURIComponent(a)}this.req.open("GET",c,this.isAsynch());this.sendPreparedRequest("")};AjaxAnywhere.prototype.sendPreparedRequest=function(b){this.req.setRequestHeader("Accept","text/xml");var a=this.id+"_callbackFunction";if(typeof window[a]=="undefined"){window[a]=new Function('AjaxAnywhere.findInstance("'+this.id+'").callback(); ')}this.req.onreadystatechange=window[a];this.showLoadingMessage();this.callbackExecuted=false;this.req.send(b);this.onRequestSent();if((!this.isAsynch())&&(!this.callbackExecuted)){window[a]()}};AjaxAnywhere.prototype.dropPreviousRequest=function(){if(this.req.readyState!=0&&this.req.readyState!=4){this.req.abort();this.handlePrevousRequestAborted()}};AjaxAnywhere.prototype.preparePostData=function(d){var f=this.findForm();var a="&aaxmlrequest=true";for(var c=0;c<f.elements.length;c++){var e=f.elements[c];if(e.tagName.toLowerCase()=="select"){for(var b=0;b<e.options.length;b++){var g=e.options[b];if(g.selected){a+="&"+encodeURIComponent(e.name)+"="+encodeURIComponent(g.value)}}}else{if(e.tagName.toLowerCase()=="textarea"){a+="&"+encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}else{if(e.tagName.toLowerCase()=="input"){if(e.type.toLowerCase()=="checkbox"||e.type.toLowerCase()=="radio"){if(e.checked){a+="&"+encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}}else{if(e.type.toLowerCase()=="submit"){if(e==d){a+="&"+encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}}else{if(e.type.toLowerCase()!="button"){a+="&"+encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}}}}}}}if(typeof d!="undefined"&&d!=null&&d.type.toLowerCase()=="image"){if(d.name==null||d.name==""||typeof d.name=="undefined"){a+="&x=1&y=1"}else{a+="&"+encodeURIComponent(d.name)+".x=1&"+encodeURIComponent(d.name)+".y=1"}}return a};function delay(b){date=new Date();var a=null;do{a=new Date()}while(a-date<b)}AjaxAnywhere.prototype.handleWrongContentType=function(){alert("AjaxAnywhere error : content-type in not text/xml : ["+this.req.getResponseHeader("content-type")+"]")};AjaxAnywhere.prototype.callback=function(){if(this.req.readyState==4){this.callbackExecuted=true;this.onBeforeResponseProcessing();this.hideLoadingMessage();if(this.req.status==200){if(this.req.getResponseHeader("content-type").toLowerCase().substring(0,8)!="text/xml"){this.handleWrongContentType();return}var docs=this.req.responseXML.getElementsByTagName("document");var redirects=this.req.responseXML.getElementsByTagName("redirect");var zones=this.req.responseXML.getElementsByTagName("zone");var exceptions=this.req.responseXML.getElementsByTagName("exception");var scripts=this.req.responseXML.getElementsByTagName("script");var images=this.req.responseXML.getElementsByTagName("image");if(redirects.length!=0){var newURL=redirects[0].firstChild.data;location.href=newURL}if(docs.length!=0){var newContent=docs[0].firstChild.data;delete this.req;document.close();document.write(newContent);document.close()}if(images.length!=0){var preLoad=new Array(images.length);for(var i=0;i<images.length;i++){var img=images[i].firstChild;if(img!=null){preLoad[i]=new Image();preLoad[i].src=img.data}}if(this.delayBeforeContentUpdate){delay(this.delayInMillis)}}if(zones.length!=0){for(var i=0;i<zones.length;i++){var zoneNode=zones[i];var name=zoneNode.getAttribute("name");var id=zoneNode.getAttribute("id");var html="";for(var childIndex=0;childIndex<zoneNode.childNodes.length;childIndex++){html+=zoneNode.childNodes[childIndex].data}var zoneHolder=name!=null?document.getElementById("aazone."+name):document.getElementById(id);if(zoneHolder!=null&&typeof(zoneHolder)!="undefined"){zoneHolder.innerHTML=html}}}if(exceptions.length!=0){var e=exceptions[0];var type=e.getAttribute("type");var stackTrace=e.firstChild.data;this.handleException(type,stackTrace)}if(scripts.length!=0){for(var $$$$i=0;$$$$i<scripts.length;$$$$i++){var script=scripts[$$$$i].firstChild;if(script!=null){script=script.data;if(script.indexOf("document.write")!=-1){this.handleException("document.write","This script contains document.write(), which is not compatible with AjaxAnywhere : \n\n"+script)}else{if(script.indexOf("___ignore=true")==-1){}if(zones.length!=0){var zoneNode=zones[0];var name=zoneNode.getAttribute("name");var zoneHolder=document.getElementById("aazone."+name);if(zoneHolder!=null&&typeof(zoneHolder)!="undefined"){var customerScript=document.createElement("script");appendChild(customerScript,script);zoneHolder.appendChild(customerScript)}}}}}var globals=this.getGlobalScriptsDeclarationsList(script);if(globals!=null){for(var i in globals){var objName=globals[i];try{window[objName]=eval(objName)}catch(e){}}}}}else{if(this.req.status!=0){this.handleHttpErrorCode(this.req.status)}}this.restoreSubstitutedSubmitButtons();this.onAfterResponseProcessing()}};function appendChild(a,b){if(null==a.canHaveChildren||a.canHaveChildren){a.appendChild(document.createTextNode(b))}else{a.text=b}}AjaxAnywhere.prototype.showLoadingMessage=function(){var a=document.getElementById("AA_"+this.id+"_loading_div");if(a==null){a=document.createElement("DIV");$(".ui-layout-center").append(a);a.id="AA_"+this.id+"_loading_div";a.innerHTML="&nbsp;\u6b63\u5728\u52a0\u8f7d...";a.style.position="absolute";a.style.border="1 solid black";a.style.color="white";a.style.backgroundColor="blue";a.style.width="100px";a.style.heigth="50px";a.style.fontFamily="Arial, Helvetica, sans-serif";a.style.fontWeight="bold";a.style.fontSize="11px"}a.style.top=document.body.scrollTop+"px";a.style.left=(document.body.offsetWidth-100-(document.all?20:0))+"px";a.style.display=""};AjaxAnywhere.prototype.hideLoadingMessage=function(){var a=document.getElementById("AA_"+this.id+"_loading_div");if(a!=null){a.style.display="none"}};AjaxAnywhere.prototype.substituteFormSubmitFunction=function(){if(this.notSupported){return}this.bindById();var b=this.findForm();b.submit_old=b.submit;var a='var ajax = AjaxAnywhere.findInstance("'+this.id+"\"); if (typeof ajax !='object' || ! ajax.isFormSubmitByAjax() ) ajax.findForm().submit_old(); else ajax.submitAJAX();";b.submit=new Function(a)};AjaxAnywhere.prototype.substituteSubmitButtonsBehavior=function(g,f){if(this.notSupported){return}var e=this.findForm();if(f==null||typeof f=="undefined"){f=new Array();for(var c=0;c<e.elements.length;c++){f.push(e.elements[c])}var a=document.getElementsByTagName("input");for(var c=0;c<a.length;c++){var b=a[c];if(b.type!=null&&typeof b.type!="undefined"&&b.type.toLowerCase()=="image"&&b.form==e){f.push(b)}}for(var c=0;c<f.length;c++){var d=f[c];if(d.tagName.toLowerCase()=="input"&&(d.type.toLowerCase()=="submit"||d.type.toLowerCase()=="image")){this.substituteSubmitBehavior(d,g)}}}else{for(var c=0;c<f.length;c++){var d=f[c];if(d==null){continue}if(typeof d!="object"){d=e.elements[d]}if(typeof d!="undefined"){if(d.tagName.toLowerCase()=="input"&&(d.type.toLowerCase()=="submit"||d.type.toLowerCase()=="image")){this.substituteSubmitBehavior(d,g)}}}}};AjaxAnywhere.prototype.substituteSubmitBehavior=function(c,e){var a=false;for(var b=0;b<this.substitutedSubmitButtons.length;b++){var d=this.substitutedSubmitButtons[b];if(d==c.name){a=true;break}}if(!a){this.substitutedSubmitButtons.push(c.name)}this.substitutedSubmitButtonsInfo[c.name]=e;if(e&&(typeof c.onclick!="undefined")&&(c.onclick!=null)&&(c.onclick!="")){c.AA_old_onclick=c.onclick}c.onclick=handleSubmitButtonClick;c.ajaxAnywhereId=this.id};AjaxAnywhere.prototype.restoreSubstitutedSubmitButtons=function(){if(this.substitutedSubmitButtons.length==0){return}var e=this.findForm();for(var c=0;c<this.substitutedSubmitButtons.length;c++){var b=this.substitutedSubmitButtons[c];var d=e.elements[b];if(d!=null&&typeof d!="undefined"){if(d.onclick!=handleSubmitButtonClick){var g=this.substitutedSubmitButtonsInfo[d.name];this.substituteSubmitBehavior(d,g)}}else{if(b!=null&&typeof b!="undefined"&&b.length!=0){var f=document.getElementsByName(b);if(f!=null){for(var a=0;a<f.length;a++){d=f[a];if(d!=null&&typeof d!="undefined"&&d.tagName.toLowerCase()=="input"&&typeof d.type!="undefined"&&d.type.toLowerCase()=="image"){if(d.onclick!=handleSubmitButtonClick){var g=this.substitutedSubmitButtonsInfo[d.name];this.substituteSubmitBehavior(d,g)}}}}}}}};function handleSubmitButtonClick(a){if(typeof this.AA_old_onclick!="undefined"){if(false==this.AA_old_onclick(a)){return false}if(typeof window.event!="undefined"){if(window.event.returnValue==false){return false}}}var b=this.form.onsubmit;if(typeof b=="function"){if(false==b(a)){return false}if(typeof window.event!="undefined"){if(window.event.returnValue==false){return false}}}AjaxAnywhere.findInstance(this.ajaxAnywhereId).submitAJAX("",this);return false}AjaxAnywhere.prototype.isFormSubmitByAjax=function(){return true};AjaxAnywhere.prototype.setDelayBeforeLoad=function(a){this.delayBeforeContentUpdate=a};AjaxAnywhere.prototype.isDelayBeforeLoad=function(){return this.delayBeforeContentUpdate};AjaxAnywhere.prototype.setDelayTime=function(a){this.delayInMillis=a};AjaxAnywhere.prototype.getDelayTime=function(){return this.delayInMillis};AjaxAnywhere.prototype.handleException=function(b,a){alert(a)};AjaxAnywhere.prototype.handleHttpErrorCode=function(b){var a=confirm("AjaxAnywhere default error handler. XMLHttpRequest HTTP Error code:"+b+" \n\n Would you like to view the response content in a new window?");if(a){var c=window.open("",this.id+"_debug_window");if(c!=null){c.document.write("<html><body><xmp>"+this.req.responseText);c.document.close();c.focus()}else{alert("Please, disable your pop-up blocker for this site first.")}}};AjaxAnywhere.prototype.handlePrevousRequestAborted=function(){};AjaxAnywhere.prototype.getGlobalScriptsDeclarationsList=function(a){return null};AjaxAnywhere.prototype.getZonesToReload=function(a,b){return this.getZonesToReaload()};AjaxAnywhere.prototype.getZonesToReaload=function(a,b){return""};AjaxAnywhere.prototype.onRequestSent=function(){};AjaxAnywhere.prototype.onBeforeResponseProcessing=function(){};AjaxAnywhere.prototype.onAfterResponseProcessing=function(){};AjaxAnywhere.prototype.onGetAjaxNotSupported=function(a){location.href=a;return false};AjaxAnywhere.prototype.onSubmitAjaxNotSupported=function(e,b){var d=this.findForm();var f=d.attributes.action;var a=f==null?null:f.nodeValue;var c=a;if(typeof e!="undefined"&&e!=null){a+=(a.indexOf("?")!=-1)?"&":"?";a+=e;d.attributes.action.nodeValue=a;d.setAttribute("method","post")}this.submitOld(d,b);d.attributes.action.nodeValue=c;return false};AjaxAnywhere.prototype.submitOld=function(c,b){var a=null;if(b!=null&&typeof b!="undefined"){a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name",b.name);a.setAttribute("value",b.value);c.appendChild(a)}if(typeof c.submit_old=="undefined"){c.submit()}else{c.submit_old()}if(b!=null){c.removeChild(a)}};ajaxAnywhere=new AjaxAnywhere();ajaxAnywhere.bindById();
