var datepickerInput;if(typeof($.jgrid)!="undefined"){jQuery.extend($.jgrid.defaults,{datatype:"json",jsonReader:{repeatitems:false},rowNum:20,prmNames:{rows:"page.pageSize",page:"page.pageNo",sort:"page.orderBy",order:"page.order"},autowidth:true,height:330,pager:"#pager",viewrecords:true,sortorder:"desc",shrinkToFit:false,multiselect:true,mtype:"POST"})}function jgridDelRow(e,c,b){var d=jQuery("#"+e).getGridParam("selarrrow");if(d==""){alert(delRowWarning)}else{if(d==0){jQuery("#"+e).jqGrid("delRowData",d[0])}else{var a={};if(b){a[b]=d.join(",")}else{a.ids=d.join(",")}$.post(c,a,function(f){jQuery("#"+e).jqGrid().trigger("reloadGrid")})}}}$(document).ready(function(){$(".ui-datepicker-close").live("click",function(){$(datepickerInput).attr("value","")});hideDashedBox();$("body").click(function(){})});function hideDashedBox(){var a=$("a");for(var b=0;b<a.length;b++){$(a[b]).attr("hideFocus","true")}}var buttonFlag=0;function ajaxAnyWhereSubmit(g,e,f,d,c,b,a){if(buttonFlag==0){buttonFlag=1;var h="#"+g;if(e!=""){$(h).attr("action",e)}ajaxAnywhere.formName=g;ajaxAnywhere.handleException=function(j,i){buttonFlag=0;var k='<TABLE height="200" cellSpacing=0 cellPadding=0 width="300" align="center" border="0"><TR><TD vAlign="center" align="middle">\u9519\u8bef\u7c7b\u578b\uff1a'+j+"<br/>\u9519\u8bef\u4fe1\u606f\uff1a"+i+"</td></tr></table>";$.colorbox({html:k,title:"\u9519\u8bef\u63d0\u793a"})};ajaxAnywhere.handleHttpErrorCode=function(i){buttonFlag=0;if(i==403){$.colorbox({href:webRoot+"/common/thickbox_403.jsp",iframe:true,innerWidth:600,innerHeight:300,overlayClose:false,title:"\u6ca1\u6709\u6743\u9650"})}else{var j='<TABLE height="100" cellSpacing=0 cellPadding=0 width="300" align="center" border="0"><TR><TD vAlign="center" align="middle">http Error code:'+i+"</td></tr></table>";$.colorbox({html:j})}};ajaxAnywhere.getZonesToReload=function(){return f};ajaxAnywhere.onBeforeResponseProcessing=function(){};ajaxAnywhere.onAfterResponseProcessing=function(){buttonFlag=0;if(typeof(d)=="function"){if(a!=""||typeof(a)!="undefined"){d(c,b,a)}else{if(b!=""||typeof(b)!="undefined"){d(c,b)}else{if(c!=""||typeof(c)!="undefined"){d(c)}else{d()}}}}removeSearchBox()};ajaxAnywhere.submitAJAX();ajaxAnywhere.handleWrongContentType=function(){window.location.reload()}}}var aa={submit:ajaxAnyWhereSubmit};function contentResize(){var d=[];var f=$getObjByClass("ui-jqgrid-btable");f.each(function(){if(this.id!=undefined&&$("#"+this.id).closest("._custom_table").length<1&&this.id.indexOf("_frozen")<0){d.push(this.id)}});var c,a;if("INSIDE_QUERY"==_gridTagParams._start_query_sign||"CUSTOM_QUERY"==_gridTagParams._start_query_sign){changePosition();if($("#containerSearchInput").val()!="false"&&$("#containerSearchInput").val()!=undefined){$("#search_box").css("width",$("#opt-content").width()+12)}}if(d.length>0){c=_getTableHeight(d);a=_getTableWidth()}for(var b=0;b<d.length;b++){if($existObjByClass("ui-jqgrid-btable")){$setJqGridSize(d[b],c,a)}if($("#parameter_Table").height()>0){$("#gbox_"+d[b]).css("top",$("#parameter_Table").height()+5)}else{if($("#advanced_search_table_id").height()>0){$("#gbox_"+d[b]).css("top",205)}else{$("#gbox_"+d[b]).css("top","")}}}var e=$getObjByClass("jqgfirstrow");e.each(function(){$(this).css("height",0.01)});contentResizeCallback()}function contentResizeCallback(){}function $setJqGridSize(c,b,a){jQuery("#"+c).jqGrid("setGridHeight",b);jQuery("#"+c).jqGrid("setGridWidth",a)}function contentResizeForFixed(){searchResize("fixed")}function contentResizeForAdvanced(){searchResize("advanced")}function searchResize(c){changePosition();var a=0;if(c=="fixed"){if($("#parameter_Table").attr("id")=="parameter_Table"){a=$("#parameter_Table").height()}}var d=[];var e=$getObjByClass("ui-jqgrid-btable");e.each(function(){if(this.id!=undefined){d.push(this.id)}});for(var b=0;b<d.length;b++){jQuery("#"+d[b]).jqGrid("setGridHeight",_getTableHeight(d));jQuery("#"+d[b]).jqGrid("setGridWidth",_getTableWidth());if(c=="fixed"){if(a==0){$("#gbox_"+d[b]).css("top",205)}else{$("#gbox_"+d[b]).css("top",a+5)}}else{if(c=="advanced"){$("#gbox_"+d[b]).css("top",205)}}}}function _getTableHeight(e){if($getObjById("parameter_Table").height()>0){if($("#parameter_Table").height()>0){heightOfSearchDiv=$("#fixedSearchZoon").height()+4}}else{if($("#advanced_search_table_id").height()>0){heightOfSearchDiv=$("#searchZoon").height()+13}else{if($("#advanced_search_table_id").height()==0){heightOfSearchDiv=0}else{heightOfSearchDiv=0}}}var d=0;if(e.length>1){d=$(".ui-layout-center").height()-185-heightOfSearchDiv}else{d=$(".ui-layout-center").height()-110-heightOfSearchDiv}var f=$(".ui-layout-center").height();if($(".opt-btn").height()>0){$("#opt-content").css("height",f-55)}else{$("#opt-content").css("height",f-20)}if($(".ui-jqgrid-sdiv").length==1){d=d-$(".ui-jqgrid-sdiv").height()}else{if($(".ui-jqgrid-sdiv").length>1){d=d-$(".ui-jqgrid-sdiv").height()*$(".ui-jqgrid-sdiv").length}}for(var c=0;c<e.length;c++){if($("#"+e[c]+"_pager").height()==0){d+=36}}var b=d/e.length;var a=$getObjByClass("widget-place");if(a.length>0){b=b-45}var a=$getObjByClass("ui-tabs");if(a.length>0){b=b-20}$("#opt-content").css("overflow","auto");return b}function _getTableWidth(){var a=$(".ui-layout-center").width()-30;if($.browser.msie){var c=document.getElementById("ui-layout-center");if(c!=null&&typeof(c)!="undefined"){if(c.scrollHeight>c.clientHeight||c.offsetHeight>c.clientHeight){a=$(".ui-layout-center").width()-45}}}var b=$getObjByClass("widget-place");if(b.length>0){a=a-25}b=$getObjByClass("ui-tabs");if(b.length>0){a=a-20}return a}function $getObjById(a){return $getObj("#"+a)}function $getObjByClass(a){return $getObj("."+a)}function $getObj(b){var a=$(b);return a}function $existObjById(a){return getObjectForTable("#"+a)}function $existObjByClass(a){return getObjectForTable("."+a)}function getObjectForTable(a){if($(a).length<1){return false}else{return true}}function showMsg(a){if(a==undefined){a="message"}$("#"+a).show();setTimeout('$("#'+a+'").hide();',3000)}function getContentHeight_ColorIframe(){var a=$(window).height();$(".opt-body").css("height",a);var b=$(".opt-body").height();$("IFrame").attr("scrolling","no");if($(".cbox-btn").height()>0){$("#opt-content").css("height",b-55)}else{$("#opt-content").css("height",b-20)}}function HideSearchBox(){$("#search_box").css("display","none")}function HideSuperSearchBox(){$("#searchZoon").css("display","none")}function getContentHeight(){var a=$(".ui-layout-center").height();if($(".opt-btn").height()>0){$("#opt-content").css("height",a-55)}else{$("#opt-content").css("height",a-20)}}function setFormgridHeight(b,a){jQuery("#"+b).jqGrid("setGridHeight",a)}function changeStyle(b,c){var a=imatrixRoot+"/portal/index/start-using-theme.htm?callback=?";b.cancelBubble=true;$.getJSON(a,function(h){var g=[];if(h.msg!=""){g=h.msg.split(",")}$("#sysTableDiv").hide();if($("#styleList").css("display")=="none"||typeof($("#styleList").css("display"))=="undefined"){if($("#styleList").attr("id")!="styleList"){var f="<div id='styleList'>";for(var e=0;e<g.length;e=e+2){f+=("<div class='styleTable'><a><img src='"+resourceRoot+"/images/"+g[e]+".gif'/><br/><span>"+g[e+1]+"</span></a></div>")}f+="</div>";$("body").append(f);addStytleClickEvent()}$("#styleList").show();var d=$(c).position();$("#styleList").css("top","66px");$("#styleList").css("right","2px");$("#styleList").css("height","auto")}else{$("#styleList").hide()}})}function addStytleClickEvent(){$(".styleTable a").click(function(){var c=$(this).children("img").attr("src").split("/");var a=c[c.length-1].replace(".gif","");var b='<form id="saveThemeForm" name="saveThemeForm" action="'+imatrixRoot+'/portal/index/index!saveTheme.htm" method="post"><input type="hidden" id="themeName" name="themeName" value="'+a+'"/><input type="hidden" id="_header_url" name="url" value="'+window.location.href+'"/></form>';$("#header").before(b);$("#saveThemeForm").submit()})}var iMatrix={showSearchDIV:function(a){if("INSIDE_QUERY"!=_gridTagParams._start_query_sign&&"CUSTOM_QUERY"!=_gridTagParams._start_query_sign){alert("\u8bf7\u5728\u5217\u8868\u8bbe\u7f6e\u4e2d\u542f\u7528\u67e5\u8be2\u529f\u80fd\uff01");return}if("CUSTOM_QUERY"==_gridTagParams._start_query_sign){if(!customSearch){initSearch();if($("#customSearchZoon").children().length>0){$("#fixedSearchZoon").children().remove();packagingCustomSearch();$("#fixedSearchZoon").append($("#customSearchZoon").children());customSearch=true}else{alert("\u60a8\u7684\u9875\u9762\u4e2d\u6ca1\u6709\u81ea\u5b9a\u4e49\u67e5\u8be2\u533a\u57df\uff01");return}}}else{if($("#customSearchZoon").length>0){$("#customSearchZoon").remove()}initSearch()}publicShowSearchDiv(a)},export_Data:function(b){if(typeof(b)!="undefined"&&b!=""){if($("#_loading_div_id").length==0){$(".opt-btn").append('<div id="_loading_div_id" class="loading">\u6b63\u5728\u52a0\u8f7d...</div>')}$("#_loading_div_id").show();if($("#_exportable_sign").val()=="false"){alert("\u8bf7\u5728\u5217\u8868\u8bbe\u7f6e\u4e2d\u542f\u7528\u5bfc\u51fa\u529f\u80fd\uff01");return}var f=jQuery("#"+$("#_main_grid_id").val()).jqGrid("getRowData");if(f.length==0){alert("\u65e0\u5bfc\u51fa\u6570\u636e\uff01");$("#_loading_div_id").hide();return}if(b.indexOf("?")>=0){b=b+"&exportParameters=export_data"}else{b=b+"?exportParameters=export_data"}var a=jQuery("#"+editableGridOptions.gridId).jqGrid("getGridParam","dynamicColumnNames");var d=jQuery("#"+editableGridOptions.gridId).jqGrid("getGridParam","postData");if(a.length>0){var e="";for(var c=0;c<a.length;c++){if(a[c].indexOf("<input")==-1){if(e!=""){e+=","}e+=a[c]}}submit_export("_dynamic_export_form",d,b,e)}else{submit_export("_dynamic_export_form",d,b,"")}}},getFormGridDatas:function(e,c){var d=isHasEdit(c);if(!d){$("#"+e).find("input[name='subTableVals']").remove();var f=$("#"+c).jqGrid("getGridParam","myattrName");var a="";var b=getOneGridDatas(e,c,f);if(b!=""){a=a+b+";"}if(a.indexOf(";")>=0){a=a.substring(0,a.length-1)}$("#"+e).append("<textarea name='subTableVals' style='display:none;'>"+a+"</textarea>")}return !d},getSubTableDatas:function(h){var g=isHasEdit();if(!g){$("#"+h).find("input[name='subTableVals']").remove();var b=$("input[pluginType='STANDARD_LIST_CONTROL']");var d="";for(var c=0;c<b.length;c++){var f="tb_"+$(b[c]).attr("id");var a=$("#"+f).jqGrid("getGridParam","indexname");var e=getOneGridDatas(h,f,$(b[c]).attr("name"));if(e!=""){d=d+e+";"}}if(d.indexOf(";")>=0){d=d.substring(0,d.length-1)}$("#"+h).append("<textarea name='subTableVals' style='display:none;'>"+d+"</textarea>")}return !g},saveForm:function(b){var a=iMatrix.getSubTableDatas(b);if(a){__parseCustomDateTypeValue()}return a},addRow:function(a){if(a==undefined){a=false}if((!editing&&!a)||a){editableGrid.resetSelection();editableGrid.jqGrid("addRow",{rowID:"0",position:"last",addRowParams:editParams});lastsel=0;makeEditable(false)}else{alert("\u8bf7\u5148\u5b8c\u6210\u7f16\u8f91\uff01")}},delRow:function(){if(editing){alert("\u8bf7\u5148\u5b8c\u6210\u7f16\u8f91\uff01");return}var a=editableGrid.getGridParam("selarrrow");if(a.length<1){alert("\u8bf7\u9009\u4e2d\u9700\u8981\u5220\u9664\u7684\u8bb0\u5f55\uff01");return}if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f")){var b={};b=$.extend(true,b,editableGridOptions.extraParams,{deleteIds:a.join(",")});$.post(editableGridOptions.deleteUrl,b,function(c){if(a.length>0){editableGrid.jqGrid().trigger("reloadGrid")}if(c!=""&&c!=null){alert(c)}})}}};
